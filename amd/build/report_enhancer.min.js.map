{"version":3,"file":"report_enhancer.min.js","sources":["../src/report_enhancer.js"],"sourcesContent":["/**\n * This JS is made to enhance the /mod/quiz/report.php?id=X&mode=overview core_moodle report table\n * and /mod/quiz/reviewquestion.php pages\n *\n * @module     quizaccess_cheatdetect/report_enhancer\n * @package\n * @copyright   2025 CBlue SPRL\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author      gnormand@cblue.be\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str'], function($, Ajax, Notification, Str) {\n\n    var config = {}; // eslint-disable-line no-unused-vars\n\n    /**\n     * Initialize the report enhancer\n     * @param {object} params Configuration parameters\n     */\n    var init = function(params) {\n        config = params;\n        // Wait for DOM to be ready\n        $(document).ready(function() {\n            // Check if we are on the review question page\n            if (window.location.pathname.indexOf('reviewquestion.php') !== -1) {\n                enhanceReviewQuestionPage();\n            } else {\n                enhanceReportTable();\n            }\n        });\n    };\n\n    /**\n     * Add data-cblue-attempt attribute to each row in the attempts table\n     * @returns {Array} Array of attempt IDs found in the table\n     */\n    var addAttemptDataAttributes = function() {\n        // Find the attempts table\n        var $attemptsTable = $('#attempts');\n        var attemptIds = [];\n\n        if ($attemptsTable.length === 0) {\n            console.warn('CheatDetect: Attempts table not found'); // eslint-disable-line no-console\n            return attemptIds;\n        }\n\n        // Iterate through each row in the tbody\n        $attemptsTable.find('tbody tr').each(function() {\n            var $row = $(this);\n\n            // Find the review link in this row\n            var $reviewLink = $row.find('.reviewlink');\n\n            if ($reviewLink.length > 0) {\n                // Get the href attribute\n                var href = $reviewLink.attr('href');\n\n                if (href) {\n                    // Extract the attempt parameter from the URL\n                    var urlParts = href.split('?');\n                    if (urlParts.length > 1) {\n                        var urlParams = new URLSearchParams(urlParts[1]);\n                        var attemptId = urlParams.get('attempt');\n\n                        if (attemptId) {\n                            // Add the data attribute to the row\n                            $row.attr('data-cblue-attempt', attemptId);\n                            // Add to the array (convert to integer)\n                            attemptIds.push(parseInt(attemptId, 10));\n                            // eslint-disable-next-line no-console\n                            console.log('CheatDetect: Added data-cblue-attempt=' + attemptId + ' to row');\n                        }\n                    }\n                }\n            }\n        });\n\n        return attemptIds;\n    };\n\n    /**\n     * Fetch bulk attempt summaries from webservice\n     * @param {Array} attemptIds Array of attempt IDs to fetch\n     */\n    var fetchBulkAttemptSummaries = function(attemptIds) {\n        if (!attemptIds || attemptIds.length === 0) {\n            console.warn('CheatDetect: No attempt IDs provided'); // eslint-disable-line no-console\n            return;\n        }\n\n        var url = '/local/rest/api/quizaccess_cheatdetect/bulk-attempt-summaries';\n        var payload = {\n            attemptids: attemptIds\n        };\n\n        console.log('CheatDetect: Fetching bulk attempt summaries for IDs:', attemptIds); // eslint-disable-line no-console\n\n        $.ajax({\n            url: url,\n            method: 'POST',\n            contentType: 'application/json',\n            data: JSON.stringify(payload),\n            dataType: 'json',\n            success: function(response) {\n                // eslint-disable-next-line no-console\n                console.log('CheatDetect: Bulk attempt summaries response:', response);\n                if (response.success && response.data) {\n                    processBulkAttemptSummaries(response.data);\n                } else {\n                    // eslint-disable-next-line no-console\n                    console.warn('CheatDetect: Invalid response from bulk summaries webservice', response);\n                }\n            },\n            error: function(xhr, status, error) {\n                console.error('CheatDetect: Error fetching bulk attempt summaries', error); // eslint-disable-line no-console\n            }\n        });\n    };\n\n    /**\n     * Determine if a slot should have a red icon based on cheat criteria\n     * @param {object} slotData Slot data from webservice\n     * @returns {boolean} True if icon should be red, false if green\n     */\n    var shouldSlotIconBeRed = function(slotData) {\n        return slotData.copy_count > 0 ||\n               slotData.focus_loss_count > 0 ||\n               slotData.has_extension === true;\n    };\n\n    /**\n     * Create SVG icon element\n     * @param {boolean} isRed True for red icon, false for green icon\n     * @param {string} iconType Type of icon: 'eye' or 'flag'\n     * @returns {jQuery} jQuery object containing the SVG icon\n     */\n    var createSvgIcon = function(isRed, iconType) {\n        var iconFile = isRed ? 'spy-icon-red.svg' : 'spy-icon-green.svg';\n        var svgPath = M.cfg.wwwroot + '/mod/quiz/accessrule/cheatdetect/pix/' + iconFile;\n\n        var $img = $('<img>')\n            .attr('src', svgPath)\n            .attr('aria-hidden', 'true')\n            .addClass('cheatdetect-svg-icon')\n            .addClass(iconType === 'eye' ? 'cheatdetect-icon-type-a' : 'cheatdetect-icon-type-b');\n\n        // Set size (20x20 for all icons)\n        if (iconType === 'eye') {\n            $img.css({\n                'width': '20px',\n                'height': '20px',\n                'margin-left': '8px',\n                'vertical-align': 'middle'\n            });\n        } else {\n            $img.css({\n                'width': '20px',\n                'height': '20px',\n                'display': 'block',\n                'margin-top': '4px'\n            });\n        }\n\n        return $img;\n    };\n\n    /**\n     * Extract slot number from reviewquestion.php URL\n     * @param {string} url URL containing slot parameter\n     * @returns {number|null} Slot number or null if not found\n     */\n    var extractSlotFromUrl = function(url) {\n        if (!url) {\n            return null;\n        }\n\n        var urlParts = url.split('?');\n        if (urlParts.length > 1) {\n            var urlParams = new URLSearchParams(urlParts[1]);\n            var slot = urlParams.get('slot');\n            return slot ? parseInt(slot, 10) : null;\n        }\n\n        return null;\n    };\n\n    /**\n     * Process bulk attempt summaries data\n     * @param {Array} summaries Array of attempt summaries from webservice\n     */\n    var processBulkAttemptSummaries = function(summaries) {\n        console.log('CheatDetect: Processing ' + summaries.length + ' attempt summaries'); // eslint-disable-line no-console\n\n        summaries.forEach(function(attemptData) {\n            var attemptId = attemptData.attemptid;\n            var slots = attemptData.slots;\n\n            // Find the corresponding table row\n            var $row = $('tr[data-cblue-attempt=\"' + attemptId + '\"]');\n\n            if ($row.length === 0) {\n                console.warn('CheatDetect: Row not found for attempt ' + attemptId); // eslint-disable-line no-console\n                return;\n            }\n\n            // eslint-disable-next-line no-console\n            console.log('CheatDetect: Processing attempt ' + attemptId + ' with ' + slots.length + ' slots');\n\n            var hasRedSlot = false;\n\n            // Process all question links in this row (Type B icons)\n            $row.find('a[href*=\"reviewquestion.php\"]').each(function() {\n                var $link = $(this);\n                var href = $link.attr('href');\n                var urlSlot = extractSlotFromUrl(href);\n\n                // Find the TD parent\n                var $td = $link.closest('td');\n\n                // Check if icon already added to this TD to avoid duplicates\n                if ($td.find('.cheatdetect-svg-icon').length > 0) {\n                    return;\n                }\n\n                // Find the slot data for this link\n                var slotData = null;\n                for (var i = 0; i < slots.length; i++) {\n                    if (slots[i].slot === urlSlot) {\n                        slotData = slots[i];\n                        break;\n                    }\n                }\n\n                var isRed = false;\n                if (slotData) {\n                    isRed = shouldSlotIconBeRed(slotData);\n\n                    if (isRed) {\n                        hasRedSlot = true;\n                    }\n                    // eslint-disable-next-line no-console\n                    console.log('CheatDetect: Data found for slot ' + urlSlot + ' (red: ' + isRed + ')');\n                } else {\n                    // No data = no cheat detected, use green icon\n                    // eslint-disable-next-line no-console\n                    console.log('CheatDetect: No data for slot ' + urlSlot + ', using green icon');\n                }\n\n                // Create the spy-icon and wrap it in a link\n                var $icon = createSvgIcon(isRed, 'flag');\n                var $iconLink = $('<a>')\n                    .attr('href', href)\n                    .css('display', 'inline-block')\n                    .append($icon);\n\n                // Inject the linked spy-icon in the TD parent\n                $td.append($iconLink);\n            });\n\n            // Process Type A icon (fa-eye)\n            var $reviewLink = $row.find('.reviewlink');\n            if ($reviewLink.length > 0) {\n                var $oldEyeIcon = $reviewLink.find('.cheatdetect-icon');\n\n                if ($oldEyeIcon.length > 0) {\n                    var $newEyeIcon = createSvgIcon(hasRedSlot, 'eye');\n                    $oldEyeIcon.replaceWith($newEyeIcon);\n                    // eslint-disable-next-line no-console\n                    console.log('CheatDetect: Replaced eye icon for attempt ' + attemptId +\n                                ' (red: ' + hasRedSlot + ')');\n                }\n            }\n        });\n\n        console.log('CheatDetect: Finished processing all attempt summaries'); // eslint-disable-line no-console\n    };\n\n    /**\n     * Enhance the report table with cheat detection information\n     */\n    var enhanceReportTable = function() {\n        // Find the report table\n        var domtable = $('table.generaltable');\n\n        if (domtable.length === 0) {\n            console.warn('CheatDetect: Report table not found'); // eslint-disable-line no-console\n            return;\n        }\n\n        console.log('CheatDetect: Enhancing report table'); // eslint-disable-line no-console\n\n        // Add data-cblue-attempt attributes to table rows and collect attempt IDs\n        var attemptIds = addAttemptDataAttributes();\n\n        // Add icons next to \"Relecture de cette tentative\" links\n        addIconsToReviewLinks();\n\n        // Fetch bulk attempt summaries if we have attempt IDs\n        if (attemptIds.length === 0) {\n            console.warn('CheatDetect: No attempts found'); // eslint-disable-line no-console\n            return;\n        }\n\n        // Fetch bulk attempt summaries from webservice\n        fetchBulkAttemptSummaries(attemptIds);\n\n        return attemptIds;\n\n    };\n\n    /**\n     * Add icons next to \"Relecture de cette tentative\" links\n     */\n    var addIconsToReviewLinks = function() {\n        // Find all review links\n        $('.reviewlink').each(function() {\n            var $link = $(this);\n\n            // Check if icon already added\n            if ($link.find('.cheatdetect-icon').length > 0) {\n                return;\n            }\n\n            // Create icon element\n            var $icon = $('<i>')\n                .addClass('fa fa-eye cheatdetect-icon')\n                .attr('aria-hidden', 'true')\n                .css({\n                    'margin-left': '8px',\n                    'color': '#0066cc'\n                });\n\n            // Append icon to the link\n            $link.append(' ').append($icon);\n        });\n    };\n\n\n    /**\n     * Enhance the review question page with cheat detection summary\n     */\n    var enhanceReviewQuestionPage = function() {\n        console.log('CheatDetect: Enhancing review question page'); // eslint-disable-line no-console\n\n        // Extract attempt and slot from URL parameters\n        var attemptId = getUrlParameter('attempt');\n        var slotId = getUrlParameter('slot');\n\n        if (!attemptId || !slotId) {\n            console.warn('CheatDetect: Missing attempt or slot parameter in URL'); // eslint-disable-line no-console\n            return;\n        }\n\n        // Fetch attempt summary data from webservice\n        fetchAttemptSummary(attemptId, slotId);\n    };\n\n    /**\n     * Get URL parameter value by name\n     * @param {string} name Parameter name\n     * @returns {string|null} Parameter value or null if not found\n     */\n    var getUrlParameter = function(name) {\n        var urlParams = new URLSearchParams(window.location.search);\n        return urlParams.get(name);\n    };\n\n    /**\n     * Fetch attempt summary data from webservice\n     * @param {string} attemptId Attempt ID\n     * @param {string} slotId Slot ID\n     */\n    var fetchAttemptSummary = function(attemptId, slotId) {\n        var url = '/local/rest/api/quizaccess_cheatdetect/attempt-summary/' + attemptId + '/slots/' + slotId;\n\n        $.ajax({\n            url: url,\n            method: 'GET',\n            dataType: 'json',\n            success: function(response) {\n                if (response.success && response.data) {\n                    createCheatDetectResumeBlock(response.data);\n                } else {\n                    console.warn('CheatDetect: Invalid response from webservice', response); // eslint-disable-line no-console\n                }\n            },\n            error: function(xhr, status, error) {\n                console.error('CheatDetect: Error fetching attempt summary', error); // eslint-disable-line no-console\n            }\n        });\n    };\n\n    /**\n     * Create and display the cheat detection resume block\n     * @param {object} data Attempt summary data from webservice\n     */\n    var createCheatDetectResumeBlock = function(data) {\n        // Check if block already exists\n        if ($('.cheatdetect_resume').length > 0) {\n            return;\n        }\n\n        // Convert time_spent from seconds to minutes\n        var timeInMinutes = Math.round(data.time_spent / 60);\n        var timePercentage = Math.round(data.time_percentage);\n\n        // Load translated strings\n        var stringKeys = [\n            {key: 'timespent', component: 'quizaccess_cheatdetect'},\n            {key: 'copycount', component: 'quizaccess_cheatdetect'},\n            {key: 'focuslosscount', component: 'quizaccess_cheatdetect'},\n            {key: 'extensiondetected', component: 'quizaccess_cheatdetect'},\n            {key: 'yes', component: 'quizaccess_cheatdetect'},\n            {key: 'no', component: 'quizaccess_cheatdetect'}\n        ];\n\n        Str.get_strings(stringKeys).then(function(strings) {\n            var timeSpentStr = strings[0];\n            var copyCountStr = strings[1];\n            var focusLossCountStr = strings[2];\n            var extensionDetectedStr = strings[3];\n            var yesStr = strings[4];\n            var noStr = strings[5];\n\n            // Determine extension detection text\n            var extensionText = data.has_extension ? yesStr : noStr;\n\n            // Create the resume block HTML\n            var $resumeBlock = $('<div>')\n                .addClass('cheatdetect_resume')\n                .css({\n                    'background-color': '#d3d3d3',\n                    'padding': '1rem 1rem',\n                    'margin-bottom': '1rem',\n                    'border': 'var(--bs-border-width) solid #fff0',\n                    'border-radius': 'var(--bs-border-radius)',\n                    'font-size': '14px',\n                    'line-height': '1.6'\n                });\n\n            // Time spent line\n            var timeSpentText = timeSpentStr\n                .replace('{$a->minutes}', timeInMinutes)\n                .replace('{$a->percentage}', timePercentage);\n            var $timeLine = $('<div>').text(timeSpentText);\n\n            // Copy count line (in red if > 0)\n            var copyCountText = copyCountStr.replace('{$a}', data.copy_count);\n            var $copyLine = $('<div>')\n                .text(copyCountText)\n                .css('color', data.copy_count > 0 ? '#ff0000' : 'inherit');\n\n            // Focus loss count line (in red if > 0)\n            var focusLossCountText = focusLossCountStr.replace('{$a}', data.focus_loss_count);\n            var $focusLine = $('<div>')\n                .text(focusLossCountText)\n                .css('color', data.focus_loss_count > 0 ? '#ff0000' : 'inherit');\n\n            // Extension detection line\n            var extensionDetectedText = extensionDetectedStr.replace('{$a}', extensionText);\n            var $extensionLine = $('<div>').text(extensionDetectedText);\n\n            // Append all lines to the block\n            $resumeBlock.append($timeLine)\n                .append($copyLine)\n                .append($focusLine)\n                .append($extensionLine);\n\n            // Insert the block after the .outcome element\n            var $outcomeContainer = $('.outcome');\n            if ($outcomeContainer.length > 0) {\n                $outcomeContainer.after($resumeBlock);\n            } else {\n                // Fallback: insert at the top of the question container\n                var $targetContainer = $('.que');\n                if ($targetContainer.length > 0) {\n                    $targetContainer.prepend($resumeBlock);\n                } else {\n                    // Last fallback: insert after the page header\n                    $('#page-content').prepend($resumeBlock);\n                }\n            }\n\n            console.log('CheatDetect: Resume block added successfully'); // eslint-disable-line no-console\n        }).catch(function(error) {\n            console.error('CheatDetect: Error loading strings', error); // eslint-disable-line no-console\n        });\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","Str","createSvgIcon","isRed","iconType","iconFile","svgPath","M","cfg","wwwroot","$img","attr","addClass","css","width","height","display","processBulkAttemptSummaries","summaries","console","log","length","forEach","attemptData","attemptId","attemptid","slots","$row","hasRedSlot","find","each","$link","this","href","urlSlot","url","urlParts","split","slot","URLSearchParams","get","parseInt","extractSlotFromUrl","$td","closest","slotData","i","copy_count","focus_loss_count","has_extension","shouldSlotIconBeRed","$icon","$iconLink","append","$reviewLink","$oldEyeIcon","$newEyeIcon","replaceWith","warn","enhanceReportTable","attemptIds","$attemptsTable","push","addAttemptDataAttributes","addIconsToReviewLinks","payload","attemptids","ajax","method","contentType","data","JSON","stringify","dataType","success","response","error","xhr","status","fetchBulkAttemptSummaries","color","enhanceReviewQuestionPage","getUrlParameter","slotId","fetchAttemptSummary","name","window","location","search","createCheatDetectResumeBlock","timeInMinutes","Math","round","time_spent","timePercentage","time_percentage","get_strings","key","component","then","strings","timeSpentStr","copyCountStr","focusLossCountStr","extensionDetectedStr","yesStr","noStr","extensionText","$resumeBlock","padding","border","timeSpentText","replace","$timeLine","text","copyCountText","$copyLine","focusLossCountText","$focusLine","extensionDetectedText","$extensionLine","$outcomeContainer","after","$targetContainer","prepend","catch","init","params","document","ready","pathname","indexOf"],"mappings":"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"}