{"version":3,"file":"report_enhancer.min.js","sources":["../src/report_enhancer.js"],"sourcesContent":["/**\n * This JS is made to enhance the /mod/quiz/report.php?id=X&mode=overview core_moodle report table\n *\n * @module     quizaccess_cheatdetect/report_enhancer\n * @package     quizaccess_cheatdetect\n * @copyright   2025 CBlue SPRL\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author      gnormand@cblue.be\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($) {\n\n    var config = {};\n\n    /**\n     * Initialize the report enhancer\n     * @param {object} params Configuration parameters\n     */\n    var init = function(params) {\n        config = params;\n        // Wait for DOM to be ready\n        $(document).ready(function() {\n            enhanceReportTable();\n        });\n    };\n\n    /**\n     * Enhance the report table with cheat detection information\n     */\n    var enhanceReportTable = function() {\n        // Find the report table\n        var domtable = $('table.generaltable');\n\n        if (domtable.length === 0) {\n            console.warn('CheatDetect: Report table not found');\n            return;\n        }\n\n        console.log('CheatDetect: Enhancing report table');\n\n        // Add icons next to \"Relecture de cette tentative\" links\n        addIconsToReviewLinks();\n\n        // Add icons next to question results\n        addIconsToQuestionResults();\n\n        // Get all attempt IDs from the table\n        var attemptIds = [1,45,78]; // futur : extractAttemptIds($table);\n\n        if (attemptIds.length === 0) {\n            console.warn('CheatDetect: No attempts found');\n            return;\n        }\n\n        return attemptIds;\n\n    };\n\n    /**\n     * Add icons next to \"Relecture de cette tentative\" links\n     */\n    var addIconsToReviewLinks = function() {\n        // Find all review links\n        $('.reviewlink').each(function() {\n            var $link = $(this);\n\n            // Check if icon already added\n            if ($link.find('.cheatdetect-icon').length > 0) {\n                return;\n            }\n\n            // Create icon element\n            var $icon = $('<i>')\n                .addClass('fa fa-eye cheatdetect-icon')\n                .attr('aria-hidden', 'true')\n                .css({\n                    'margin-left': '8px',\n                    'color': '#0066cc'\n                });\n\n            // Append icon to the link\n            $link.append(' ').append($icon);\n        });\n    };\n\n    /**\n     * Add icons next to question results\n     */\n    var addIconsToQuestionResults = function() {\n        // Find all question result links (links in cells that contain question grades)\n        $('table.generaltable tbody tr').each(function() {\n            var $row = $(this);\n\n            // Find cells with question results (columns after c8, which is the total grade)\n            $row.find('td[class*=\"c9\"], td[class*=\"c10\"], td[class*=\"c11\"], td[class*=\"c12\"], td[class*=\"c13\"],' +\n                      'td[class*=\"c14\"], td[class*=\"c15\"], td[class*=\"c16\"], td[class*=\"c17\"], td[class*=\"c18\"]').each(function() {\n                var $cell = $(this);\n                var $link = $cell.find('a[href*=\"reviewquestion.php\"]');\n\n                if ($link.length > 0) {\n                    // Check if icon already added\n                    if ($link.find('.cheatdetect-qicon').length > 0) {\n                        return;\n                    }\n\n                    // Create icon element\n                    var $icon = $('<i>')\n                        .addClass('fa fa-flag cheatdetect-qicon')\n                        .attr('aria-hidden', 'true')\n                        .css({\n                            'margin-left': '6px',\n                            'color': '#ff6600',\n                            'font-size': '0.9em'\n                        });\n\n                    // Append icon after the link content\n                    $link.append(' ').append($icon);\n                }\n            });\n        });\n    };\n    return {\n        init: init\n    };\n});"],"names":["define","$","enhanceReportTable","length","console","log","addIconsToReviewLinks","addIconsToQuestionResults","attemptIds","warn","each","$link","this","find","$icon","addClass","attr","css","color","append","init","params","document","ready"],"mappings":";;;;;;;;;AAUAA,OAAM,yCAAC,CAAC,SAAU,YAAa,qBAAsB,SAASC,GAE1D,IAiBIC,mBAAqB,WAIrB,GAAwB,IAFTD,EAAE,sBAEJE,OAAb,CAKAC,QAAQC,IAAI,uCAGZC,wBAGAC,4BAGA,IAAIC,WAAa,CAAC,EAAE,GAAG,IAEvB,GAA0B,IAAtBA,WAAWL,OAKf,OAAOK,WAJHJ,QAAQK,KAAK,iCAdjB,MAFIL,QAAQK,KAAK,wCA2BjBH,sBAAwB,WAExBL,EAAE,eAAeS,KAAK,WAClB,IAAIC,MAAQV,EAAEW,MAGd,KAAID,MAAME,KAAK,qBAAqBV,OAAS,GAA7C,CAKA,IAAIW,MAAQb,EAAE,OACTc,SAAS,8BACTC,KAAK,cAAe,QACpBC,IAAI,CACD,cAAe,MACfC,MAAS,YAIjBP,MAAMQ,OAAO,KAAKA,OAAOL,MAZzB,CAaJ,IAMAP,0BAA4B,WAE5BN,EAAE,+BAA+BS,KAAK,WACvBT,EAAEW,MAGRC,KAAK,oLAC4FH,KAAK,WACvG,IACIC,MADQV,EAAEW,MACIC,KAAK,iCAEvB,GAAIF,MAAMR,OAAS,EAAG,CAElB,GAAIQ,MAAME,KAAK,sBAAsBV,OAAS,EAC1C,OAIJ,IAAIW,MAAQb,EAAE,OACTc,SAAS,gCACTC,KAAK,cAAe,QACpBC,IAAI,CACD,cAAe,MACfC,MAAS,UACT,YAAa,UAIrBP,MAAMQ,OAAO,KAAKA,OAAOL,MAC7B,CACJ,EACJ,IAEJ,MAAO,CACHM,KAxGO,SAASC,QAGhBpB,EAAEqB,UAAUC,MAAM,WACdrB,oBACJ,IAqGR"}