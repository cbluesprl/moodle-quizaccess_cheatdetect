{"version":3,"file":"report_enhancer.min.js","sources":["../src/report_enhancer.js"],"sourcesContent":["/**\n * @fileoverview Report enhancer module for quiz cheat detection visualization\n *\n * This module enhances the /mod/quiz/report.php?id=X&mode=overview core Moodle report table\n * and /mod/quiz/reviewquestion.php pages with cheat detection indicators and popovers.\n *\n * @module     quizaccess_cheatdetect/report_enhancer\n * @copyright  2025 CBlue SPRL\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author     gnormand@cblue.be, jdeboysere@cblue.be\n * @since      1.0.0\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'theme_boost/bootstrap/popover'],\nfunction($, Ajax, Notification, Str, Popover) {\n\n    // Toggle between mock data and real webservice calls\n    const USE_MOCK_DATA = false;\n\n    // Toggle console logging for debugging\n    const SHOW_CONSOLE_LOG = true;\n\n    if (USE_MOCK_DATA) {\n        console.warn('ðŸš¨ USE_MOCK_DATA set on TRUE. That means it will use fake data. ðŸš¨');\n    }\n\n    /**\n     * Initialize the report enhancer\n     * @param {object} params Configuration parameters (unused, reserved for future use)\n     */\n    var init = function(params) { // eslint-disable-line no-unused-vars\n        // Wait for DOM to be ready\n        $(document).ready(function() {\n            if (window.location.pathname.indexOf('/mod/quiz/report.php') !== -1) {\n                enhanceReportTable();\n            } else if (window.location.pathname.indexOf('/mod/quiz/reviewquestion.php') !== -1) {\n                enhanceReviewQuestionPage();\n            } else if (window.location.pathname.indexOf('/mod/quiz/review.php') !== -1) {\n                enhanceReviewQuestionPage();\n            }\n        });\n    };\n\n    /**\n     * Add data-cblue-attempt attribute to each row in the attempts table\n     * @returns {Array} Array of attempt IDs found in the table\n     */\n    var addAttemptDataAttributes = function() {\n        // Find the attempts table\n        var $attemptsTable = $('#attempts');\n        var attemptIds = [];\n\n        if ($attemptsTable.length === 0) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: Attempts table not found'); // eslint-disable-line no-console\n            }\n            return attemptIds;\n        }\n\n        // Iterate through each row in the tbody\n        $attemptsTable.find('tbody tr').each(function() {\n            var $row = $(this);\n\n            // Find the review link in this row\n            var $reviewLink = $row.find('.reviewlink');\n\n            if ($reviewLink.length > 0) {\n                // Get the href attribute\n                var href = $reviewLink.attr('href');\n\n                if (href) {\n                    // Extract the attempt parameter from the URL\n                    var urlParts = href.split('?');\n                    if (urlParts.length > 1) {\n                        var urlParams = new URLSearchParams(urlParts[1]);\n                        var attemptId = urlParams.get('attempt');\n\n                        if (attemptId) {\n                            // Add the data attribute to the row\n                            $row.attr('data-cblue-attempt', attemptId);\n                            // Add to the array (convert to integer)\n                            attemptIds.push(parseInt(attemptId, 10));\n                            if (SHOW_CONSOLE_LOG) {\n                                // eslint-disable-next-line no-console\n                                console.log('CheatDetect: Added data-cblue-attempt=' + attemptId + ' to row');\n                            }\n                        }\n                    }\n                }\n            }\n        });\n\n        return attemptIds;\n    };\n\n    /**\n     * Add data-cblue-slot attribute to each TD containing reviewquestion.php links\n     */\n    var addSlotDataAttributes = function() {\n        // Find all links to reviewquestion.php\n        $('a[href*=\"reviewquestion.php\"]').each(function() {\n            var $link = $(this);\n            var href = $link.attr('href');\n\n            if (href) {\n                var slotId = extractSlotFromUrl(href);\n                if (slotId) {\n                    // Find the TD parent and add the data attribute\n                    var $td = $link.closest('td');\n                    $td.attr('data-cblue-slot', slotId);\n                    if (SHOW_CONSOLE_LOG) {\n                        // eslint-disable-next-line no-console\n                        console.log('CheatDetect: Added data-cblue-slot=' + slotId + ' to TD');\n                    }\n                }\n            }\n        });\n    };\n\n    /**\n     * Fetch bulk attempt summaries from webservice\n     * @param {Array} attemptIds Array of attempt IDs to fetch\n     */\n    var fetchBulkAttemptSummaries = function(attemptIds) {\n        if (!attemptIds || attemptIds.length === 0) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: No attempt IDs provided'); // eslint-disable-line no-console\n            }\n            return;\n        }\n\n        Ajax.call([{\n            methodname: 'quizaccess_cheatdetect_get_bulk_attempt_summaries',\n            args: {\n                attemptids: attemptIds\n            }\n        }])[0].then(function(response) {\n            if (SHOW_CONSOLE_LOG) {\n                // eslint-disable-next-line no-console\n                console.log('CheatDetect: Bulk attempt summaries response:', response);\n            }\n\n            if (Array.isArray(response)) {\n                processBulkAttemptSummaries(response);\n            } else if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: Invalid WS response structure', response);\n            }\n        }).catch(function(error) {\n            if (SHOW_CONSOLE_LOG) {\n                // eslint-disable-next-line no-console\n                console.error('CheatDetect: AJAX error fetching bulk attempt summaries', error);\n            }\n            Notification.exception(error);\n        });\n\n    };\n\n    /**\n     * Create SVG icon element\n     * @param {string} iconColor Color of icon: 'red', 'green', or 'gray'\n     * @param {string} iconType Type of icon: 'summary' or 'question'\n     * @returns {jQuery} jQuery object containing the SVG icon\n     */\n    var createSvgIcon = function(iconColor, iconType) {\n        var iconFile = 'spy-icon-' + iconColor + '.svg';\n        var svgPath = M.cfg.wwwroot + '/mod/quiz/accessrule/cheatdetect/pix/' + iconFile;\n\n        var $img = $('<img>')\n            .attr('src', svgPath)\n            .attr('aria-hidden', 'true')\n            .addClass('cheatdetect-svg-icon')\n            .attr('data-cblue-spyicon', iconType);\n\n        return $img;\n    };\n\n    /**\n     * Extract slot number from reviewquestion.php URL\n     * @param {string} url URL containing slot parameter\n     * @returns {number|null} Slot number or null if not found\n     */\n    var extractSlotFromUrl = function(url) {\n        if (!url) {\n            return null;\n        }\n\n        var urlParts = url.split('?');\n        if (urlParts.length > 1) {\n            var urlParams = new URLSearchParams(urlParts[1]);\n            var slot = urlParams.get('slot');\n            return slot ? parseInt(slot, 10) : null;\n        }\n\n        return null;\n    };\n\n    /**\n     * Extract attempt ID from URL query parameter\n     * @returns {string|null} Attempt ID from URL parameter or null if not found\n     */\n    var getAttemptIdFromUrl = function() {\n        var urlParams = new URLSearchParams(window.location.search);\n        var attemptId = urlParams.get('attempt');\n\n        if (!attemptId) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: No attempt parameter found in URL'); // eslint-disable-line no-console\n            }\n            return null;\n        }\n\n        if (SHOW_CONSOLE_LOG) {\n            console.log('CheatDetect: Attempt parameter found in URL (' + attemptId + ')'); // eslint-disable-line no-console\n        }\n        return attemptId;\n    };\n\n    /**\n     * Format duration from seconds to human readable string\n     * Handles days, hours, minutes, seconds with proper singular/plural\n     * @param {number} totalSeconds Time spent in seconds\n     * @param {object} strings Translated strings containing day/days/hour/hours/minute/minutes/second/seconds\n     * @returns {string} Formatted duration string (e.g., \"2 hours 30 minutes 15 seconds\")\n     */\n    var formatDuration = function(totalSeconds, strings) {\n        var days = Math.floor(totalSeconds / 86400);\n        var hours = Math.floor((totalSeconds % 86400) / 3600);\n        var minutes = Math.floor((totalSeconds % 3600) / 60);\n        var seconds = Math.floor(totalSeconds % 60);\n\n        var parts = [];\n\n        if (days > 0) {\n            parts.push(days + ' ' + (days > 1 ? strings.days : strings.day));\n        }\n        if (hours > 0) {\n            parts.push(hours + ' ' + (hours > 1 ? strings.hours : strings.hour));\n        }\n        if (minutes > 0) {\n            parts.push(minutes + ' ' + (minutes > 1 ? strings.minutes : strings.minute));\n        }\n        // Show seconds only if less than 1 hour, or if it's the only unit\n        if (seconds > 0 && (days === 0 && hours === 0) || parts.length === 0) {\n            parts.push(seconds + ' ' + (seconds > 1 ? strings.seconds : strings.second));\n        }\n\n        // If all values are 0, show \"0 second\"\n        if (parts.length === 0) {\n            parts.push('0 ' + strings.second);\n        }\n\n        return parts.join(' ');\n    };\n\n    /**\n     * Generate popover content HTML for a slot\n     * @param {object} slotData Slot data from webservice\n     * @param {object} strings Translated strings from language files\n     * @param {number|string} slotId The slot/question number\n     * @returns {string} HTML content for the popover\n     */\n    var generatePopoverContent = function(slotData, strings, slotId) {\n        // Format duration with appropriate units\n        var durationText = formatDuration(slotData.time_spent, strings);\n        var timePercentage = Math.round(slotData.time_percentage);\n\n        // Build HTML content as bullet list\n        var html = '<ul class=\"mb-0\">';\n\n        // Time spent (with slot number)\n        var timeSpentText = strings.timespent\n            .replace('{$a->duration}', durationText)\n            .replace('{$a->percentage}', timePercentage)\n            .replace('{$a->slot}', slotId);\n        html += '<li>' + timeSpentText + '</li>';\n\n        // Copy count (red if > 0)\n        var copyCountText = strings.copycount.replace('{$a}', slotData.copy_count);\n        if (slotData.copy_count > 0) {\n            html += '<li class=\"text-danger fw-bold\">' + copyCountText + '</li>';\n        } else {\n            html += '<li>' + copyCountText + '</li>';\n        }\n\n        // Focus loss count (red if > 0)\n        var focusLossText = strings.focuslosscount.replace('{$a}', slotData.focus_loss_count);\n        if (slotData.focus_loss_count > 0) {\n            html += '<li class=\"text-danger fw-bold\">' + focusLossText + '</li>';\n        } else {\n            html += '<li>' + focusLossText + '</li>';\n        }\n\n        // Extension detection (red if true)\n        var extensionText = slotData.has_extension ? strings.yes : strings.no;\n        var extensionDetectedText = strings.extensiondetected.replace('{$a}', extensionText);\n        if (slotData.has_extension) {\n            html += '<li class=\"text-danger fw-bold\">' + extensionDetectedText + '</li>';\n        } else {\n            html += '<li>' + extensionDetectedText + '</li>';\n        }\n\n        html += '</ul>';\n\n        return html;\n    };\n\n    /**\n     * Initialize Bootstrap popovers using jQuery (works with Bootstrap 4 and 5)\n     */\n    var initializePopovers = function() {\n        // Find all popover trigger elements\n        var $popoverElements = $('[data-bs-toggle=\"popover\"]');\n\n        $popoverElements.each(function() {\n            var $element = $(this);\n\n            // Check if already initialized\n            if ($element.data('cheatdetect-initialized')) {\n                return;\n            }\n            $element.data('cheatdetect-initialized', true);\n\n            // Get original content\n            var originalContent = $element.attr('data-bs-content') || '';\n            var title = $element.attr('data-bs-title') || '';\n\n            // Initialize popover with Bootstrap Popover constructor\n            var popoverInstance = new Popover($element[0], {\n                html: true,\n                trigger: 'manual',\n                placement: 'left',\n                title: title,\n                content: originalContent,\n                sanitize: false\n            });\n\n            // Store instance for later use\n            $element.data('popover-instance', popoverInstance);\n\n            // Desktop: show on hover (only for non-touch devices)\n            $element.on('mouseenter', function() {\n                // Skip on touch devices (they use click/tap)\n                if ('ontouchstart' in window) {\n                    return;\n                }\n                // Skip if popover already visible for this element\n                if ($element.attr('aria-describedby')) {\n                    return;\n                }\n                $element.data('popover-hover', true);\n                // Hide any other open popovers first\n                hideAllPopoversExcept($element);\n                popoverInstance.show();\n            });\n\n            // Desktop: hide on mouse leave (with delay to allow moving to popover)\n            $element.on('mouseleave', function(e) {\n                // Skip on touch devices\n                if ('ontouchstart' in window) {\n                    return;\n                }\n                // Check if mouse moved to the popover itself\n                var $relatedTarget = $(e.relatedTarget);\n                if ($relatedTarget.closest('.popover').length > 0) {\n                    // Mouse moved to popover, don't hide\n                    $element.data('popover-inside', true);\n                    return;\n                }\n                $element.data('popover-hover', false);\n                setTimeout(function() {\n                    // Don't hide if mouse is back on trigger or inside popover\n                    if (!$element.data('popover-hover') && !$element.data('popover-inside')) {\n                        popoverInstance.hide();\n                    }\n                }, 300);\n            });\n\n            // Mobile/Tablet & Keyboard: toggle on click/tap/enter\n            $element.on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var isVisible = $element.attr('aria-describedby');\n                hideAllPopovers();\n                if (!isVisible) {\n                    popoverInstance.show();\n                }\n            });\n\n            // Keyboard accessibility: Enter and Space to toggle, Escape to close\n            $element.on('keydown', function(e) {\n                if (e.key === 'Enter' || e.key === ' ') {\n                    e.preventDefault();\n                    var isVisible = $element.attr('aria-describedby');\n                    hideAllPopovers();\n                    if (!isVisible) {\n                        popoverInstance.show();\n                    }\n                } else if (e.key === 'Escape') {\n                    popoverInstance.hide();\n                }\n            });\n\n            // Ensure button is focusable and has proper ARIA attributes\n            $element.attr('tabindex', '0');\n            $element.attr('role', 'button');\n            $element.attr('aria-expanded', 'false');\n\n            // Update aria-expanded when popover shows/hides\n            $element.on('shown.bs.popover', function() {\n                $element.attr('aria-expanded', 'true');\n            });\n            $element.on('hidden.bs.popover', function() {\n                $element.attr('aria-expanded', 'false');\n                $element.data('popover-hover', false);\n                $element.data('popover-inside', false);\n            });\n        });\n\n        // Setup close handlers\n        setupPopoverCloseHandlers();\n\n        if (SHOW_CONSOLE_LOG) {\n            // eslint-disable-next-line no-console\n            console.log('CheatDetect: Initialized ' + $popoverElements.length + ' Bootstrap popovers');\n        }\n    };\n\n    /**\n     * Hide all Bootstrap popovers except the specified element\n     * @param {jQuery} $except Element to exclude from hiding\n     */\n    var hideAllPopoversExcept = function($except) {\n        $('[data-bs-toggle=\"popover\"]').each(function() {\n            var $el = $(this);\n            if (!$except || $el[0] !== $except[0]) {\n                var instance = $el.data('popover-instance');\n                if (instance) {\n                    instance.hide();\n                }\n            }\n        });\n    };\n\n    /**\n     * Hide all Bootstrap popovers\n     */\n    var hideAllPopovers = function() {\n        $('[data-bs-toggle=\"popover\"]').each(function() {\n            var instance = $(this).data('popover-instance');\n            if (instance) {\n                instance.hide();\n            }\n        });\n    };\n\n    /**\n     * Setup event handlers for popover hover behavior\n     */\n    var setupPopoverCloseHandlers = function() {\n        // Track mouse entering popover content (desktop only)\n        $(document).off('mouseenter.cheatdetect', '.popover');\n        $(document).on('mouseenter.cheatdetect', '.popover', function() {\n            if ('ontouchstart' in window) {\n                return;\n            }\n            var popoverId = $(this).attr('id');\n            var $trigger = $('[aria-describedby=\"' + popoverId + '\"]');\n            $trigger.data('popover-inside', true);\n        });\n\n        // Track mouse leaving popover content (desktop only)\n        $(document).off('mouseleave.cheatdetect', '.popover');\n        $(document).on('mouseleave.cheatdetect', '.popover', function() {\n            if ('ontouchstart' in window) {\n                return;\n            }\n            var popoverId = $(this).attr('id');\n            var $trigger = $('[aria-describedby=\"' + popoverId + '\"]');\n            $trigger.data('popover-inside', false);\n            // Hide after a small delay\n            setTimeout(function() {\n                if (!$trigger.data('popover-hover') && !$trigger.data('popover-inside')) {\n                    var instance = $trigger.data('popover-instance');\n                    if (instance) {\n                        instance.hide();\n                    }\n                }\n            }, 300);\n        });\n\n        // Prevent clicks inside popover from bubbling\n        $(document).off('click.cheatdetect-inside', '.popover');\n        $(document).on('click.cheatdetect-inside', '.popover', function(e) {\n            e.stopPropagation();\n        });\n\n        // Handle click/tap outside to close popovers\n        $(document).off('click.cheatdetect-outside touchend.cheatdetect-outside');\n        $(document).on('click.cheatdetect-outside touchend.cheatdetect-outside', function(e) {\n            if ($(e.target).closest('[data-bs-toggle=\"popover\"]').length > 0) {\n                return;\n            }\n            if ($(e.target).closest('.popover').length > 0) {\n                return;\n            }\n            hideAllPopovers();\n        });\n\n        // Global Escape key handler to close any open popover\n        $(document).off('keydown.cheatdetect-escape');\n        $(document).on('keydown.cheatdetect-escape', function(e) {\n            if (e.key === 'Escape') {\n                hideAllPopovers();\n            }\n        });\n    };\n\n    /**\n     * Process bulk attempt summaries data\n     * @param {Array} summaries Array of attempt summaries from webservice\n     */\n    var processBulkAttemptSummaries = function(summaries) {\n        if (SHOW_CONSOLE_LOG) {\n            console.log('CheatDetect: Processing ' + summaries.length + ' attempt summaries'); // eslint-disable-line no-console\n        }\n\n        // Load translated strings first\n        var stringKeys = [\n            {key: 'questiondetails', component: 'quizaccess_cheatdetect'},\n            {key: 'timespent', component: 'quizaccess_cheatdetect'},\n            {key: 'day', component: 'quizaccess_cheatdetect'},\n            {key: 'days', component: 'quizaccess_cheatdetect'},\n            {key: 'hour', component: 'quizaccess_cheatdetect'},\n            {key: 'hours', component: 'quizaccess_cheatdetect'},\n            {key: 'minute', component: 'quizaccess_cheatdetect'},\n            {key: 'minutes', component: 'quizaccess_cheatdetect'},\n            {key: 'second', component: 'quizaccess_cheatdetect'},\n            {key: 'seconds', component: 'quizaccess_cheatdetect'},\n            {key: 'copycount', component: 'quizaccess_cheatdetect'},\n            {key: 'focuslosscount', component: 'quizaccess_cheatdetect'},\n            {key: 'extensiondetected', component: 'quizaccess_cheatdetect'},\n            {key: 'yes', component: 'quizaccess_cheatdetect'},\n            {key: 'no', component: 'quizaccess_cheatdetect'},\n            {key: 'closepopover', component: 'quizaccess_cheatdetect'},\n            {key: 'multiplepageswarning', component: 'quizaccess_cheatdetect'},\n            {key: 'cheatdetection', component: 'quizaccess_cheatdetect'}\n        ];\n\n        Str.get_strings(stringKeys).then(function(stringsArray) {\n            // Build strings object for easier access\n            var strings = {\n                questiondetails: stringsArray[0],\n                timespent: stringsArray[1],\n                day: stringsArray[2],\n                days: stringsArray[3],\n                hour: stringsArray[4],\n                hours: stringsArray[5],\n                minute: stringsArray[6],\n                minutes: stringsArray[7],\n                second: stringsArray[8],\n                seconds: stringsArray[9],\n                copycount: stringsArray[10],\n                focuslosscount: stringsArray[11],\n                extensiondetected: stringsArray[12],\n                yes: stringsArray[13],\n                no: stringsArray[14],\n                closepopover: stringsArray[15],\n                multiplepageswarning: stringsArray[16],\n                cheatdetection: stringsArray[17]\n            };\n\n            processAttemptSummariesWithStrings(summaries, strings);\n        }).catch(function(error) {\n            if (SHOW_CONSOLE_LOG) {\n                console.error('CheatDetect: Error loading strings', error); // eslint-disable-line no-console\n            }\n        });\n    };\n\n    /**\n     * Process attempt summaries with loaded strings\n     * @param {Array} summaries Array of attempt summaries from webservice\n     * @param {object} strings Translated strings from language files\n     */\n    var processAttemptSummariesWithStrings = function(summaries, strings) {\n        summaries.forEach(function(attemptData) {\n            var attemptId = attemptData.attemptid;\n            var slots = attemptData.slots;\n\n            // Find the corresponding table row\n            var $row = $('tr[data-cblue-attempt=\"' + attemptId + '\"]');\n\n            if ($row.length === 0) {\n                if (SHOW_CONSOLE_LOG) {\n                    console.warn('CheatDetect: Row not found for attempt ' + attemptId); // eslint-disable-line no-console\n                }\n                return;\n            }\n\n            if (SHOW_CONSOLE_LOG) {\n                // eslint-disable-next-line no-console\n                console.log('CheatDetect: Processing attempt ' + attemptId + ' with ' + slots.length + ' slots');\n            }\n\n            // Check if quiz has multiple questions per page (tracking not reliable in this case)\n            var hasOnlyOneQuestionPerPage = attemptData.summary &&\n                                             attemptData.summary.has_only_one_question_per_page === true;\n\n            // If has_only_one_question_per_page is false, use gray-strike icon and skip slot icons\n            if (hasOnlyOneQuestionPerPage === false) {\n                if (SHOW_CONSOLE_LOG) {\n                    // eslint-disable-next-line no-console\n                    console.log('CheatDetect: Quiz has multiple questions per page, using gray-strike icon for attempt ' +\n                                attemptId);\n                }\n\n                // Only process summary icon with gray-strike color, skip slot icons\n                var $reviewLinkStrike = $row.find('.reviewlink');\n                if ($reviewLinkStrike.length > 0) {\n                    var $oldEyeIconStrike = $reviewLinkStrike.siblings('.cheatdetect-icon');\n                    if ($oldEyeIconStrike.length > 0) {\n                        var $newEyeIconStrike = createSvgIcon('gray-strike', 'summary');\n\n                        // Create button with popover (same style as question icons)\n                        var $iconButtonStrike = $('<button>')\n                            .attr('type', 'button')\n                            .attr('data-bs-toggle', 'popover')\n                            .attr('data-bs-trigger', 'click')\n                            .attr('data-bs-html', 'true')\n                            .attr('data-bs-title', strings.cheatdetection || 'Cheat Detection')\n                            .attr('data-bs-content', strings.multiplepageswarning)\n                            .attr('data-bs-placement', 'left')\n                            .addClass('btn btn-link p-0 cheatdetect-icon-button')\n                            .append($newEyeIconStrike);\n\n                        $oldEyeIconStrike.replaceWith($iconButtonStrike);\n                        if (SHOW_CONSOLE_LOG) {\n                            // eslint-disable-next-line no-console\n                            console.log('CheatDetect: Replaced summary icon with gray-strike for attempt ' + attemptId);\n                        }\n                    }\n                }\n                return; // Skip to next attempt, don't process slot icons\n            }\n\n            var hasRedSlot = false;\n\n            // If slots array is empty, we need to add gray icons to all TDs with data-cblue-slot\n            if (!slots || slots.length === 0) {\n                if (SHOW_CONSOLE_LOG) {\n                    // eslint-disable-next-line no-console\n                    console.log('CheatDetect: No slot data for attempt ' + attemptId + ', using gray icons');\n                }\n\n                $row.find('td[data-cblue-slot]').each(function() {\n                    var $td = $(this);\n\n                    // Check if icon already added\n                    if ($td.find('.cheatdetect-svg-icon').length > 0) {\n                        return;\n                    }\n\n                    var slotId = $td.attr('data-cblue-slot');\n                    var $link = $td.find('a[href*=\"reviewquestion.php\"]').first();\n\n                    if ($link.length > 0) {\n                        var $icon = createSvgIcon('gray', 'question');\n\n                        // Generate popover content using translated strings\n                        var grayPopoverData = {\n                            time_spent: 0,\n                            time_percentage: 0,\n                            copy_count: 0,\n                            focus_loss_count: 0,\n                            has_extension: false\n                        };\n                        var grayPopoverContent = generatePopoverContent(grayPopoverData, strings, slotId);\n\n                        var $iconButton = $('<button>')\n                            .attr('type', 'button')\n                            .attr('data-bs-toggle', 'popover')\n                            .attr('data-bs-trigger', 'click')\n                            .attr('data-bs-html', 'true')\n                            .attr('data-bs-title', strings.questiondetails)\n                            .attr('data-bs-content', grayPopoverContent)\n                            .attr('data-bs-placement', 'left')\n                            .addClass('btn btn-link p-0 cheatdetect-icon-button')\n                            .append($icon);\n\n                        $td.append($iconButton);\n                        if (SHOW_CONSOLE_LOG) {\n                            // eslint-disable-next-line no-console\n                            console.log('CheatDetect: Added gray icon for slot ' + slotId);\n                        }\n                    }\n                });\n            } else {\n                // Process each slot from the webservice data\n                slots.forEach(function(slotData) {\n                    var slotId = slotData.slot;\n\n                    // Find the TD with both data-cblue-attempt (via parent row) and data-cblue-slot\n                    var $td = $row.find('td[data-cblue-slot=\"' + slotId + '\"]');\n\n                    if ($td.length === 0) {\n                        if (SHOW_CONSOLE_LOG) {\n                            // eslint-disable-next-line no-console\n                            console.warn('CheatDetect: TD not found for attempt ' + attemptId + ' slot ' + slotId);\n                        }\n                        return;\n                    }\n\n                    // Check if icon already added\n                    if ($td.find('.cheatdetect-svg-icon').length > 0) {\n                        return;\n                    }\n\n                    // Determine icon color based on cheat_detected\n                    var iconColor = slotData.cheat_detected ? 'red' : 'green';\n\n                    if (slotData.cheat_detected) {\n                        hasRedSlot = true;\n                    }\n\n                    // Find the link in this TD\n                    var $link = $td.find('a[href*=\"reviewquestion.php\"]').first();\n\n                    if ($link.length > 0) {\n                        var $icon = createSvgIcon(iconColor, 'question');\n\n                        // Generate popover content with translated strings\n                        var popoverContent = generatePopoverContent(slotData, strings, slotId);\n\n                        var $iconButton = $('<button>')\n                            .attr('type', 'button')\n                            .attr('data-bs-toggle', 'popover')\n                            .attr('data-bs-trigger', 'click')\n                            .attr('data-bs-html', 'true')\n                            .attr('data-bs-title', strings.questiondetails)\n                            .attr('data-bs-content', popoverContent)\n                            .attr('data-bs-placement', 'left')\n                            .addClass('btn btn-link p-0 cheatdetect-icon-button')\n                            .append($icon);\n\n                        $td.append($iconButton);\n                        if (SHOW_CONSOLE_LOG) {\n                            // eslint-disable-next-line no-console\n                            console.log('CheatDetect: Added ' + iconColor + ' icon for slot ' + slotId +\n                                        ' (cheat_detected: ' + slotData.cheat_detected + ')');\n                        }\n                    }\n                });\n            }\n\n            // Process summary icon (outside the review link, as sibling)\n            var $reviewLink = $row.find('.reviewlink');\n            if ($reviewLink.length > 0) {\n                var $oldEyeIcon = $reviewLink.siblings('.cheatdetect-icon');\n\n                if ($oldEyeIcon.length > 0) {\n                    // Use gray if no slots, red if any slot is red, green otherwise\n                    var summaryColor = (!slots || slots.length === 0) ? 'gray' : (hasRedSlot ? 'red' : 'green');\n                    var $newEyeIcon = createSvgIcon(summaryColor, 'summary');\n                    $oldEyeIcon.replaceWith($newEyeIcon);\n                    if (SHOW_CONSOLE_LOG) {\n                        // eslint-disable-next-line no-console\n                        console.log('CheatDetect: Replaced summary icon for attempt ' + attemptId +\n                                    ' (color: ' + summaryColor + ')');\n                    }\n                }\n            }\n        });\n\n        if (SHOW_CONSOLE_LOG) {\n            console.log('CheatDetect: Finished processing all attempt summaries'); // eslint-disable-line no-console\n        }\n\n        // Initialize popovers with sanitize: false to allow red color styles\n        initializePopovers();\n    };\n\n    /**\n     * Enhance the report table with cheat detection information\n     * Adds data attributes, icons, and fetches cheat detection summaries\n     * @function enhanceReportTable\n     * @returns {Array|undefined} Array of attempt IDs or undefined if no table found\n     * @since 1.0.0\n     */\n    var enhanceReportTable = function() {\n        // Find the report table\n        var domtable = $('table.generaltable');\n\n        if (domtable.length === 0) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: Report table not found'); // eslint-disable-line no-console\n            }\n            return;\n        }\n\n        if (SHOW_CONSOLE_LOG) {\n            console.log('CheatDetect: Enhancing report table'); // eslint-disable-line no-console\n        }\n\n        // Add data-cblue-attempt attributes to table rows and collect attempt IDs\n        var attemptIds = addAttemptDataAttributes();\n\n        // Add data-cblue-slot attributes to TDs containing reviewquestion.php links\n        addSlotDataAttributes();\n\n        // Add icons next to \"Relecture de cette tentative\" links\n        addIconsToReviewLinks();\n\n        // Fetch bulk attempt summaries if we have attempt IDs\n        if (attemptIds.length === 0) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: No attempts found'); // eslint-disable-line no-console\n            }\n            return;\n        }\n\n        // Fetch bulk attempt summaries from webservice\n        fetchBulkAttemptSummaries(attemptIds);\n\n        return attemptIds;\n\n    };\n\n    /**\n     * Add eye icons next to review attempt links\n     * Icons will be replaced with colored SVG icons after data is fetched\n     * @function addIconsToReviewLinks\n     * @returns {void}\n     * @since 1.0.0\n     */\n    var addIconsToReviewLinks = function() {\n        // Find all review links\n        $('.reviewlink').each(function() {\n            var $link = $(this);\n\n            // Check if icon already added (now outside the link, as sibling)\n            if ($link.siblings('.cheatdetect-icon').length > 0) {\n                return;\n            }\n\n            // Create icon element\n            var $icon = $('<i>')\n                .addClass('fa fa-eye cheatdetect-icon')\n                .attr('aria-hidden', 'true');\n\n            // Insert icon after the link (outside, not inside)\n            $link.after($icon);\n        });\n    };\n\n\n    /**\n     * Enhance the review question page with cheat detection summary\n     * Finds all #question-X-Y elements and injects summary blocks\n     */\n    var enhanceReviewQuestionPage = function() {\n        if (SHOW_CONSOLE_LOG) {\n            console.log('CheatDetect: Enhancing review question page'); // eslint-disable-line no-console\n        }\n\n        // Get attemptId from URL parameter\n        var attemptId = getAttemptIdFromUrl();\n\n        if (!attemptId) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: Cannot enhance review page without attempt ID'); // eslint-disable-line no-console\n            }\n            return;\n        }\n\n        // Find all question elements with pattern #question-{number}-{number}\n        var questionElements = $('[id^=\"question-\"]').filter(function() {\n            return /^question-\\d+-\\d+$/.test(this.id);\n        });\n\n        if (questionElements.length === 0) {\n            if (SHOW_CONSOLE_LOG) {\n                console.warn('CheatDetect: No question elements found'); // eslint-disable-line no-console\n            }\n            return;\n        }\n\n        if (SHOW_CONSOLE_LOG) {\n            console.log('CheatDetect: Found ' + questionElements.length + ' question elements'); // eslint-disable-line no-console\n        }\n\n        // Process each question element\n        questionElements.each(function() {\n            var $questionElement = $(this);\n            var elementId = $questionElement.attr('id');\n\n            // Extract slotId from element ID (attemptId comes from URL)\n            var matches = elementId.match(/^question-\\d+-(\\d+)$/);\n            if (matches) {\n                var slotId = matches[1];\n\n                if (SHOW_CONSOLE_LOG) {\n                    // eslint-disable-next-line no-console\n                    console.log('CheatDetect: Processing question element - attempt: ' + attemptId + ', slot: ' + slotId);\n                }\n\n                fetchAttemptSummary(attemptId, slotId, $questionElement);\n            }\n        });\n    };\n\n    /**\n     * Fetch attempt summary data from webservice\n     * @param {string} attemptId Attempt ID\n     * @param {string} slotId Slot ID\n     * @param {jQuery} $questionElement The question element to inject the summary into\n     */\n    var fetchAttemptSummary = function(attemptId, slotId, $questionElement) {\n        Ajax.call([{\n            methodname: 'quizaccess_cheatdetect_get_slot_summary',\n            args: {\n                attemptid: attemptId,\n                slot: slotId\n            }\n        }])[0].then(function(response) {\n            if (response) {\n                createCheatDetectResumeBlock(response, $questionElement, slotId);\n            } else if (SHOW_CONSOLE_LOG) {\n                // eslint-disable-next-line no-console\n                console.warn('CheatDetect: Empty slot summary response');\n            }\n        }).catch(function(error) {\n            if (SHOW_CONSOLE_LOG) {\n                // eslint-disable-next-line no-console\n                console.error('CheatDetect: AJAX error fetching slot summary', error);\n            }\n            Notification.exception(error);\n        });\n\n    };\n\n    /**\n     * Create and display the cheat detection resume block\n     * @param {object} data Attempt summary data from webservice\n     * @param {jQuery} $questionElement The question element to inject the summary into\n     * @param {string} slotId The slot/question number\n     */\n    var createCheatDetectResumeBlock = function(data, $questionElement, slotId) {\n        // Check if block already exists in this question element\n        if ($questionElement.find('.cheatdetect_resume').length > 0) {\n            return;\n        }\n\n        var timePercentage = Math.round(data.time_percentage);\n\n        // Load translated strings\n        var stringKeys = [\n            {key: 'timespent', component: 'quizaccess_cheatdetect'},\n            {key: 'day', component: 'quizaccess_cheatdetect'},\n            {key: 'days', component: 'quizaccess_cheatdetect'},\n            {key: 'hour', component: 'quizaccess_cheatdetect'},\n            {key: 'hours', component: 'quizaccess_cheatdetect'},\n            {key: 'minute', component: 'quizaccess_cheatdetect'},\n            {key: 'minutes', component: 'quizaccess_cheatdetect'},\n            {key: 'second', component: 'quizaccess_cheatdetect'},\n            {key: 'seconds', component: 'quizaccess_cheatdetect'},\n            {key: 'copycount', component: 'quizaccess_cheatdetect'},\n            {key: 'focuslosscount', component: 'quizaccess_cheatdetect'},\n            {key: 'extensiondetected', component: 'quizaccess_cheatdetect'},\n            {key: 'yes', component: 'quizaccess_cheatdetect'},\n            {key: 'no', component: 'quizaccess_cheatdetect'}\n        ];\n\n        Str.get_strings(stringKeys).then(function(stringsArray) {\n            var strings = {\n                timespent: stringsArray[0],\n                day: stringsArray[1],\n                days: stringsArray[2],\n                hour: stringsArray[3],\n                hours: stringsArray[4],\n                minute: stringsArray[5],\n                minutes: stringsArray[6],\n                second: stringsArray[7],\n                seconds: stringsArray[8],\n                copycount: stringsArray[9],\n                focuslosscount: stringsArray[10],\n                extensiondetected: stringsArray[11],\n                yes: stringsArray[12],\n                no: stringsArray[13]\n            };\n\n            // Determine extension detection text\n            var extensionText = data.has_extension ? strings.yes : strings.no;\n\n            // Determine block color based on cheat_detected\n            var blockColorClass = 'cheatdetect_resume--gray';\n            if (data.cheat_detected !== undefined) {\n                blockColorClass = data.cheat_detected ? 'cheatdetect_resume--red' : 'cheatdetect_resume--green';\n            }\n\n            // Create the resume block HTML\n            var $resumeBlock = $('<div>').addClass('cheatdetect_resume').addClass(blockColorClass);\n\n            // Format duration with appropriate units\n            var durationText = formatDuration(data.time_spent, strings);\n\n            // Time spent line (with slot number)\n            var timeSpentText = strings.timespent\n                .replace('{$a->duration}', durationText)\n                .replace('{$a->percentage}', timePercentage)\n                .replace('{$a->slot}', slotId);\n            var $timeLine = $('<div>').text(timeSpentText);\n\n            // Copy count line (add alert class if > 0)\n            var copyCountText = strings.copycount.replace('{$a}', data.copy_count);\n            var $copyLine = $('<div>').text(copyCountText);\n            if (data.copy_count > 0) {\n                $copyLine.addClass('cheatdetect-alert');\n            }\n\n            // Focus loss count line (add alert class if > 0)\n            var focusLossCountText = strings.focuslosscount.replace('{$a}', data.focus_loss_count);\n            var $focusLine = $('<div>').text(focusLossCountText);\n            if (data.focus_loss_count > 0) {\n                $focusLine.addClass('cheatdetect-alert');\n            }\n\n            // Extension detection line\n            var extensionDetectedText = strings.extensiondetected.replace('{$a}', extensionText);\n            var $extensionLine = $('<div>').text(extensionDetectedText);\n\n            // Append all lines to the block\n            $resumeBlock.append($timeLine)\n                .append($copyLine)\n                .append($focusLine)\n                .append($extensionLine);\n\n            // Insert the block after the .formulation element within the question element\n            var $formulationContainer = $questionElement.find('.formulation');\n            if ($formulationContainer.length > 0) {\n                $formulationContainer.before($resumeBlock);\n            } else {\n                // Fallback: insert at the top of the question element\n                $questionElement.prepend($resumeBlock);\n            }\n\n            // Trigger fade-in animation after a small delay (allows CSS transition to work)\n            setTimeout(function() {\n                $resumeBlock.addClass('cheatdetect_resume--visible');\n            }, 50);\n\n            if (SHOW_CONSOLE_LOG) {\n                // eslint-disable-next-line no-console\n                console.log('CheatDetect: Resume block added to ' + $questionElement.attr('id'));\n            }\n        }).catch(function(error) {\n            if (SHOW_CONSOLE_LOG) {\n                console.error('CheatDetect: Error loading strings', error); // eslint-disable-line no-console\n            }\n        });\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","Ajax","Notification","Str","Popover","createSvgIcon","iconColor","iconType","iconFile","svgPath","M","cfg","wwwroot","attr","addClass","extractSlotFromUrl","url","urlParts","split","length","slot","URLSearchParams","get","parseInt","formatDuration","totalSeconds","strings","days","Math","floor","hours","minutes","seconds","parts","push","day","hour","minute","second","join","generatePopoverContent","slotData","slotId","durationText","time_spent","timePercentage","round","time_percentage","html","timespent","replace","copyCountText","copycount","copy_count","focusLossText","focuslosscount","focus_loss_count","extensionText","has_extension","yes","no","extensionDetectedText","extensiondetected","hideAllPopoversExcept","$except","each","$el","this","instance","data","hide","hideAllPopovers","setupPopoverCloseHandlers","document","off","on","window","popoverId","$trigger","setTimeout","e","stopPropagation","target","closest","key","processBulkAttemptSummaries","summaries","console","log","get_strings","component","then","stringsArray","questiondetails","closepopover","multiplepageswarning","cheatdetection","processAttemptSummariesWithStrings","catch","error","$popoverElements","forEach","attemptData","attemptId","attemptid","slots","$row","summary","has_only_one_question_per_page","hasRedSlot","$td","find","cheat_detected","first","$icon","popoverContent","$iconButton","append","warn","grayPopoverContent","$reviewLink","$oldEyeIcon","siblings","summaryColor","$newEyeIcon","replaceWith","$reviewLinkStrike","$oldEyeIconStrike","$newEyeIconStrike","$iconButtonStrike","$element","originalContent","title","popoverInstance","trigger","placement","content","sanitize","show","relatedTarget","preventDefault","isVisible","enhanceReportTable","attemptIds","$attemptsTable","href","addAttemptDataAttributes","$link","addIconsToReviewLinks","call","methodname","args","attemptids","response","Array","isArray","exception","fetchBulkAttemptSummaries","after","enhanceReviewQuestionPage","location","search","getAttemptIdFromUrl","questionElements","filter","test","id","$questionElement","matches","match","fetchAttemptSummary","createCheatDetectResumeBlock","blockColorClass","undefined","$resumeBlock","timeSpentText","$timeLine","text","$copyLine","focusLossCountText","$focusLine","$extensionLine","$formulationContainer","before","prepend","init","params","ready","pathname","indexOf"],"mappings":"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"}