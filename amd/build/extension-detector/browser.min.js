/**
 * @fileoverview Gestionnaire de navigateur pour la vÃ©rification des fichiers d'extension
 * @module quizaccess_cheatdetect/extension-detector/browser
 * @copyright 2025 CBlue SRL <support@cblue.be>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since 1.0.0
 */
define("quizaccess_cheatdetect/extension-detector/browser",["quizaccess_cheatdetect/extension-detector/config","quizaccess_cheatdetect/shared/utils"],function(Config,SharedUtils){var BrowserHandler=function(){this.activeRequests=new Set};return BrowserHandler.prototype.checkFiles=function(extensionPath,filesToCheck){var self=this;return Config.SETTINGS.enableLogging&&console.log("ðŸ§© Extension Detector: VÃ©rification de "+Object.keys(filesToCheck).length+" fichiers"),this._checkMultipleFiles(extensionPath,filesToCheck).then(function(results){return self._analyzeResults(results)})},BrowserHandler.prototype.extractExtensionId=function(content){if(!content)return null;var match=content.match(Config.EXTENSION_URL_REGEX);return match?match[0]:null},BrowserHandler.prototype.isExtensionAccessible=function(extensionPath){var manifestUrl=extensionPath+"/manifest.json";return SharedUtils.fetchWithTimeout(manifestUrl,3e3).then(function(result){return result.success})},BrowserHandler.prototype._checkMultipleFiles=function(extensionPath,filesToCheck){var self=this,promises=Object.keys(filesToCheck).map(function(fileName){var contentChecks=filesToCheck[fileName];return self._checkSingleFile(extensionPath,fileName,contentChecks)});return Promise.all(promises)},BrowserHandler.prototype._checkSingleFile=function(extensionPath,fileName,contentChecks){var self=this,fileUrl=extensionPath+"/"+fileName,requestId=extensionPath+":"+fileName;return this.activeRequests.has(requestId)?Promise.resolve({file:fileName,skipped:!0}):(this.activeRequests.add(requestId),SharedUtils.fetchWithTimeout(fileUrl,Config.SETTINGS.fileCheckTimeout).then(function(fetchResult){return self.activeRequests.delete(requestId),fetchResult.success?contentChecks&&0!==contentChecks.length?fetchResult.response.text().then(function(content){var detected=self._validateContent(content,contentChecks);return{file:fileName,success:!0,detected:detected,reason:detected?"Validation du contenu rÃ©ussie":"Validation du contenu Ã©chouÃ©e",contentLength:content.length}}):{file:fileName,success:!0,detected:!0,reason:"Le fichier existe"}:{file:fileName,success:!1,error:fetchResult.error,detected:!1}}).catch(function(error){return self.activeRequests.delete(requestId),{file:fileName,success:!1,error:error.message,detected:!1}}))},BrowserHandler.prototype._validateContent=function(content,patterns){return!(!content||!patterns||0===patterns.length)&&patterns.some(function(pattern){return content.includes(pattern)})},BrowserHandler.prototype._analyzeResults=function(results){var successful=results.filter(function(r){return r.success}),detected=results.filter(function(r){return r.detected}),failed=results.filter(function(r){return!r.success});if(Config.SETTINGS.enableLogging){if(detected.length>0){var detectedFiles=detected.map(function(r){return r.file}).join(", ");console.log("ðŸ§© Extension Detector: Fichiers dÃ©tectÃ©s - "+detectedFiles)}if(failed.length>0){var failedFiles=failed.map(function(r){return r.file}).join(", ");console.warn("ðŸ§© Extension Detector: VÃ©rifications de fichiers Ã©chouÃ©es - "+failedFiles)}}return{success:!0,totalFiles:results.length,successfulChecks:successful.length,detectedFiles:detected.length,failedChecks:failed.length,detected:detected.length>0,results:results,evidence:detected.map(function(r){return r.file})}},BrowserHandler.prototype.cleanup=function(){Config.SETTINGS.enableLogging&&console.log("ðŸ§© Extension Detector: Nettoyage de "+this.activeRequests.size+" requÃªtes actives"),this.activeRequests.clear()},{BrowserHandler:BrowserHandler}});

//# sourceMappingURL=browser.min.js.map