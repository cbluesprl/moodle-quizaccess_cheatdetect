{"version":3,"file":"index.min.js","sources":["../../src/extension-detector/index.js"],"sourcesContent":["/**\n * @fileoverview Point d'entr√©e AMD pour le d√©tecteur d'extensions avec exports s√©curis√©s\n * @module quizaccess_cheatdetect/extension-detector/index\n * @copyright 2025 CBlue SRL <support@cblue.be>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 1.0.0\n */\n\ndefine([\n    'quizaccess_cheatdetect/extension-detector/detector'\n], function(ExtensionDetector) {\n    'use strict';\n\n    /**\n     * Instance priv√©e du d√©tecteur\n     * @type {Object|null}\n     * @private\n     */\n    let detectorInstance = null;\n\n    /**\n     * Initialise le syst√®me de d√©tection d'extensions\n     * Appel√© par Moodle via $PAGE->requires->js_call_amd()\n     * @function init\n     * @param {Object} [backendParams] - Param√®tres du backend (non utilis√© actuellement)\n     * @returns {Object|null} Instance du d√©tecteur ou null si √©chec\n     * @example\n     * // Appel√© depuis PHP/Moodle\n     * ExtensionDetector.init(backendParams);\n     * @since 1.0.0\n     */\n    var init = function(backendParams) {\n        try {\n            // V√©rification des pr√©requis de base\n            if (typeof MutationObserver === 'undefined') {\n                return null;\n            }\n\n            // CORRECTION CRITIQUE: Attendre que le tracking soit pr√™t\n            // avant de d√©marrer la d√©tection d'extensions\n            if (!window._trackingInitialized) {\n\n                // Attendre que le tracking soit initialis√©\n                const checkTracking = setInterval(() => {\n                    if (window._trackingInitialized) {\n                        clearInterval(checkTracking);\n                        startDetector();\n                    }\n                }, 100); // V√©rifier toutes les 100ms\n\n                // Timeout de s√©curit√© apr√®s 5 secondes\n                setTimeout(() => {\n                    clearInterval(checkTracking);\n                    if (!detectorInstance) {\n                        console.warn('üß© Extension Detector: Timeout, d√©marrage forc√© sans tracking');\n                        startDetector();\n                    }\n                }, 5000);\n\n                return null;\n            } else {\n                // Le tracking est d√©j√† pr√™t\n                return startDetector();\n            }\n\n        } catch (error) {\n            console.error('üß© Extension Detector: Erreur d\\'initialisation', error);\n            return null;\n        }\n    };\n\n    /**\n     * D√©marre le d√©tecteur d'extensions\n     * @function startDetector\n     * @returns {Object|null} Instance du d√©tecteur\n     * @private\n     */\n    function startDetector() {\n        try {\n            if (detectorInstance) {\n                console.log('üß© Extension Detector: Instance d√©j√† cr√©√©e');\n                return detectorInstance;\n            }\n\n            // Cr√©ation et d√©marrage du d√©tecteur\n            detectorInstance = new ExtensionDetector.ExtensionDetector();\n            detectorInstance.start();\n\n            console.log('üß© Extension Detector: D√©marr√© avec succ√®s');\n            return detectorInstance;\n\n        } catch (error) {\n            console.error('üß© Extension Detector: Erreur de d√©marrage', error);\n            return null;\n        }\n    }\n\n    /**\n     * R√©cup√®re les m√©triques d'extensions au format JSON\n     * M√©thode s√©curis√©e pour que d'autres modules acc√®dent aux m√©triques\n     * @function getMetrics\n     * @returns {string} Cha√Æne JSON des m√©triques actuelles ou objet vide si non disponible\n     * @example\n     * const metricsJSON = ExtensionDetector.getMetrics();\n     * const metrics = JSON.parse(metricsJSON);\n     * console.log(metrics.extensionDetection);\n     * @since 1.0.0\n     */\n    var getMetrics = function() {\n        if (!detectorInstance) {\n            return JSON.stringify({\n                timestamp: new Date().toISOString(),\n                extensionDetection: {}\n            });\n        }\n\n        try {\n            return detectorInstance.exportMetricsAsJSON();\n        } catch (error) {\n            return JSON.stringify({\n                timestamp: new Date().toISOString(),\n                extensionDetection: {},\n                error: error.message\n            });\n        }\n    };\n\n    // API publique\n    return {\n        init: init,\n        getMetrics: getMetrics\n    };\n});"],"names":["define","ExtensionDetector","detectorInstance","startDetector","console","log","start","error","init","backendParams","MutationObserver","window","_trackingInitialized","checkTracking","setInterval","clearInterval","setTimeout","warn","getMetrics","JSON","stringify","timestamp","Date","toISOString","extensionDetection","exportMetricsAsJSON","message"],"mappings":";;;;;;;AAQAA,yDAAO,CACH,sDACD,SAASC,mBAQR,IAAIC,iBAAmB,KA2DvB,SAASC,gBACL,IACI,OAAID,kBACAE,QAAQC,IAAI,8CACLH,mBAIXA,iBAAmB,IAAID,kBAAkBA,kBACzCC,iBAAiBI,QAEjBF,QAAQC,IAAI,8CACLH,iBAEV,CAAC,MAAOK,OAEL,OADAH,QAAQG,MAAM,6CAA8CA,OACrD,IACX,CACJ,CAiCA,MAAO,CACHC,KAlGO,SAASC,eAChB,IAEI,GAAgC,oBAArBC,iBACP,OAAO,KAKX,GAAKC,OAAOC,qBAsBR,OAAOT,gBAtBuB,CAG9B,MAAMU,cAAgBC,YAAY,KAC1BH,OAAOC,uBACPG,cAAcF,eACdV,kBAEL,KAWH,OARAa,WAAW,KACPD,cAAcF,eACTX,mBACDE,QAAQa,KAAK,iEACbd,kBAEL,KAEI,IACX,CAKH,CAAC,MAAOI,OAEL,OADAH,QAAQG,MAAM,iDAAmDA,OAC1D,IACX,GA8DAW,WAtBa,WACb,IAAKhB,iBACD,OAAOiB,KAAKC,UAAU,CAClBC,WAAW,IAAIC,MAAOC,cACtBC,mBAAoB,CAAC,IAI7B,IACI,OAAOtB,iBAAiBuB,qBAC3B,CAAC,MAAOlB,OACL,OAAOY,KAAKC,UAAU,CAClBC,WAAW,IAAIC,MAAOC,cACtBC,mBAAoB,CAAE,EACtBjB,MAAOA,MAAMmB,SAErB,GAQR"}