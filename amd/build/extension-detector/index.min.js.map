{"version":3,"file":"index.min.js","sources":["../../src/extension-detector/index.js"],"sourcesContent":["/**\n * @fileoverview AMD entry point for extension detector with secure exports\n * @module quizaccess_cheatdetect/extension-detector/index\n * @copyright 2025 CBlue SRL <support@cblue.be>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 1.0.0\n */\n\ndefine([\n    'quizaccess_cheatdetect/extension-detector/detector'\n], function(ExtensionDetector) {\n    'use strict';\n\n    /**\n     * Private detector instance\n     * @type {Object|null}\n     * @private\n     */\n    let detectorInstance = null;\n\n    /**\n     * Initialize the extension detection system\n     * Called by Moodle via $PAGE->requires->js_call_amd()\n     * @function init\n     * @param {Object} [backendParams] - Backend parameters (not currently used)\n     * @returns {Object|null} Detector instance or null if failed\n     * @example\n     * // Called from PHP/Moodle\n     * ExtensionDetector.init(backendParams);\n     * @since 1.0.0\n     */\n    var init = function(backendParams) { // eslint-disable-line no-unused-vars\n        try {\n            // Basic prerequisites check\n            if (typeof MutationObserver === 'undefined') {\n                return null;\n            }\n\n            // CRITICAL FIX: Wait for tracking to be ready\n            // before starting extension detection\n            if (!window._trackingInitialized) {\n\n                // Wait for tracking to be initialized\n                const checkTracking = setInterval(() => {\n                    if (window._trackingInitialized) {\n                        clearInterval(checkTracking);\n                        startDetector();\n                    }\n                }, 100); // Check every 100ms\n\n                // Safety timeout after 5 seconds\n                setTimeout(() => {\n                    clearInterval(checkTracking);\n                    if (!detectorInstance) {\n                        // eslint-disable-next-line no-console\n                        console.warn('ðŸ§© Extension Detector: Timeout, forced start without tracking');\n                        startDetector();\n                    }\n                }, 5000);\n\n                return null;\n            } else {\n                // Tracking is already ready\n                return startDetector();\n            }\n\n        } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error('ðŸ§© Extension Detector: Initialization error', error);\n            return null;\n        }\n    };\n\n    /**\n     * Start the extension detector\n     * @function startDetector\n     * @returns {Object|null} Detector instance\n     * @private\n     */\n    function startDetector() {\n        try {\n            if (detectorInstance) {\n                // eslint-disable-next-line no-console\n                console.log('ðŸ§© Extension Detector: Instance already created');\n                return detectorInstance;\n            }\n\n            // Create and start detector\n            detectorInstance = new ExtensionDetector.ExtensionDetector();\n            detectorInstance.start();\n\n            // eslint-disable-next-line no-console\n            console.log('ðŸ§© Extension Detector: Started successfully');\n            return detectorInstance;\n\n        } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error('ðŸ§© Extension Detector: Startup error', error);\n            return null;\n        }\n    }\n\n    /**\n     * Get extension metrics as JSON\n     * Secure method for other modules to access metrics\n     * @function getMetrics\n     * @returns {string} JSON string of current metrics or empty object if unavailable\n     * @example\n     * const metricsJSON = ExtensionDetector.getMetrics();\n     * const metrics = JSON.parse(metricsJSON);\n     * console.log(metrics.extensionDetection);\n     * @since 1.0.0\n     */\n    var getMetrics = function() {\n        if (!detectorInstance) {\n            return JSON.stringify({\n                timestamp: new Date().toISOString(),\n                extensionDetection: {}\n            });\n        }\n\n        try {\n            return detectorInstance.exportMetricsAsJSON();\n        } catch (error) {\n            return JSON.stringify({\n                timestamp: new Date().toISOString(),\n                extensionDetection: {},\n                error: error.message\n            });\n        }\n    };\n\n    // Public API\n    return {\n        init: init,\n        getMetrics: getMetrics\n    };\n});\n"],"names":["define","ExtensionDetector","detectorInstance","startDetector","console","log","start","error","init","backendParams","MutationObserver","window","_trackingInitialized","checkTracking","setInterval","clearInterval","setTimeout","warn","getMetrics","JSON","stringify","timestamp","Date","toISOString","extensionDetection","exportMetricsAsJSON","message"],"mappings":";;;;;;;AAQAA,yDAAO,CACH,uDACD,SAASC,uBAQJC,iBAAmB,cA6DdC,2BAEGD,kBAEAE,QAAQC,IAAI,mDACLH,mBAIXA,iBAAmB,IAAID,kBAAkBA,kBACzCC,iBAAiBI,QAGjBF,QAAQC,IAAI,+CACLH,kBAET,MAAOK,cAELH,QAAQG,MAAM,uCAAwCA,OAC/C,YAmCR,CACHC,KAvGO,SAASC,sBAGoB,oBAArBC,wBACA,QAKNC,OAAOC,4BAuBDT,gBAvBuB,OAGxBU,cAAgBC,aAAY,KAC1BH,OAAOC,uBACPG,cAAcF,eACdV,mBAEL,YAGHa,YAAW,KACPD,cAAcF,eACTX,mBAEDE,QAAQa,KAAK,iEACbd,mBAEL,KAEI,MAMb,MAAOI,cAELH,QAAQG,MAAM,8CAA+CA,OACtD,OAkEXW,WAtBa,eACRhB,wBACMiB,KAAKC,UAAU,CAClBC,WAAW,IAAIC,MAAOC,cACtBC,mBAAoB,gBAKjBtB,iBAAiBuB,sBAC1B,MAAOlB,cACEY,KAAKC,UAAU,CAClBC,WAAW,IAAIC,MAAOC,cACtBC,mBAAoB,GACpBjB,MAAOA,MAAMmB"}