{"version":3,"file":"detector.min.js","sources":["../../src/extension-detector/detector.js"],"sourcesContent":["/**\n * @fileoverview D√©tecteur d'extensions principal avec gestionnaire de m√©triques\n * @module quizaccess_cheatdetect/extension-detector/detector\n * @copyright 2025 CBlue SRL <support@cblue.be>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 1.0.0\n */\n\ndefine([\n    'quizaccess_cheatdetect/extension-detector/config',\n    'quizaccess_cheatdetect/extension-detector/browser',\n    'quizaccess_cheatdetect/extension-detector/shadow',\n    'quizaccess_cheatdetect/shared/utils',\n    'quizaccess_cheatdetect/extension-detector/metrics-manager'\n], function(Config, Browser, Shadow, SharedUtils, MetricsManager) {\n    'use strict';\n\n    /**\n     * @typedef {Object} ExtensionDetectorState\n     * @property {Set<string>} detectedExtensions - Extensions d√©tect√©es\n     * @property {Map<string, number>} extensionPaths - Chemins d'extension avec timestamp\n     * @property {boolean} isRunning - √âtat de fonctionnement\n     */\n\n    /**\n     * Constructeur du d√©tecteur d'extensions principal\n     * @class ExtensionDetector\n     * @throws {Error} Si le navigateur n'est pas support√©\n     * @example\n     * const detector = new ExtensionDetector();\n     * detector.start();\n     * @since 1.0.0\n     */\n    var ExtensionDetector = function() {\n        var self = this;\n\n        this.browserHandler = new Browser.BrowserHandler();\n        this.shadowMonitor = new Shadow.ShadowMonitor(function(extensionKey, extension, method) {\n            self._onExtensionDetected(extensionKey, extension, method);\n        });\n\n        // Gestionnaire de m√©triques simplifi√©\n        this.metricsManager = new MetricsManager.MetricsManager();\n\n        // Connexion du gestionnaire de m√©triques au moniteur shadow\n        this.shadowMonitor.setMetricsManager(this.metricsManager);\n\n        // Connexion du callback pour la d√©tection d'ID d'extension\n        this.shadowMonitor.setExtensionIdDetectedCallback(function(extensionKey, extensionId) {\n            // Scanner le DOM pour supprimer tous les √©l√©ments avec cet ID\n            self._scanAndRemoveElementsWithExtensionId(extensionKey, extensionId);\n        });\n\n        // √âtat de d√©tection\n        this.detectedExtensions = new Set();\n        this.isRunning = false;\n    };\n\n    /**\n     * D√©marre le syst√®me de d√©tection\n     * @memberof ExtensionDetector\n     * @function start\n     * @throws {Error} Si le d√©marrage √©choue\n     * @example\n     * detector.start();\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.start = function() {\n        if (this.isRunning) {\n            if (Config.SETTINGS.enableLogging) {\n                // eslint-disable-next-line no-console\n                console.warn('üß© Extension Detector: D√©j√† en cours d\\'ex√©cution');\n            }\n            return;\n        }\n\n        this.isRunning = true;\n\n        try {\n            // R√©initialiser l'√©tat\n            this._resetState();\n\n            // D√©marrer la surveillance du Shadow DOM\n            this.shadowMonitor.start();\n\n        } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error('üß© Extension Detector: √âchec du d√©marrage', error);\n            this.isRunning = false;\n            throw error;\n        }\n    };\n\n    /**\n     * Arr√™te le syst√®me de d√©tection\n     * @memberof ExtensionDetector\n     * @function stop\n     * @example\n     * detector.stop();\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.stop = function() {\n        if (!this.isRunning) {\n            return;\n        }\n\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Arr√™t du syst√®me de d√©tection');\n        }\n        this.isRunning = false;\n\n        // Arr√™ter les composants\n        this.shadowMonitor.stop();\n        this.browserHandler.cleanup();\n\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Syst√®me de d√©tection arr√™t√©');\n        }\n    };\n\n    /**\n     * Red√©marre le syst√®me de d√©tection\n     * @memberof ExtensionDetector\n     * @function restart\n     * @example\n     * detector.restart();\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.restart = function() {\n        var self = this;\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Red√©marrage du syst√®me');\n        }\n        this.stop();\n        setTimeout(function() {\n            self.start();\n        }, 1000);\n    };\n\n    /**\n     * G√®re la d√©tection d'extension\n     * @memberof ExtensionDetector\n     * @function _onExtensionDetected\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @param {Object} extension - Configuration de l'extension\n     * @param {string} method - M√©thode de d√©tection utilis√©e\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._onExtensionDetected = function(extensionKey, extension, method) {\n        // √âviter les d√©tections dupliqu√©es\n        if (this.detectedExtensions.has(extensionKey)) {\n            return;\n        }\n\n        this.detectedExtensions.add(extensionKey);\n\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üö® Extension Detector: ' + extension.name + ' d√©tect√©e via ' + method);\n        }\n\n        // Logger l'√©v√©nement de d√©tection\n        if (Config.SETTINGS.enableLogging) {\n            this._logDetection(extensionKey, extension.name, method);\n        }\n    };\n\n    /**\n     * G√®re la d√©tection d'ID d'extension\n     * @memberof ExtensionDetector\n     * @function _onExtensionIdDetected\n     * @param {string} extensionPath - Chemin de l'extension\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._onExtensionIdDetected = function(extensionPath) {\n        var self = this;\n\n        if (this.extensionPaths.has(extensionPath)) {\n return;\n}\n\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Chemin d\\'extension d√©tect√© - ' + extensionPath);\n        }\n        this.extensionPaths.set(extensionPath, Date.now());\n\n        // V√©rifier si l'extension est accessible\n        this.browserHandler.isExtensionAccessible(extensionPath)\n            .then(function(isAccessible) {\n                if (!isAccessible) {\n                    if (Config.SETTINGS.enableLogging) {\n                        // eslint-disable-next-line no-console\n                        console.warn('üß© Extension Detector: Extension √† ' + extensionPath + ' non accessible');\n                    }\n                    return;\n                }\n\n                // V√©rifier les fichiers pour toutes les extensions configur√©es\n                self._checkFilesForAllExtensions(extensionPath);\n            });\n    };\n\n    /**\n     * V√©rifie les fichiers d'extension pour toutes les configurations\n     * @memberof ExtensionDetector\n     * @function _checkFilesForAllExtensions\n     * @param {string} extensionPath - Chemin de l'extension\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._checkFilesForAllExtensions = function(extensionPath) {\n        var self = this;\n        var extensions = Config.getAllExtensions();\n\n        extensions.forEach(function(extension) {\n            if (!extension.files || Object.keys(extension.files).length === 0) {\n                return;\n            }\n\n            self.browserHandler.checkFiles(extensionPath, extension.files)\n                .then(function(result) {\n                    if (result.detected) {\n                        self._onExtensionDetected(extension.key, extension, 'fileCheck');\n                    }\n                })\n                .catch(function(error) {\n                    if (Config.SETTINGS.enableLogging) {\n                        // eslint-disable-next-line no-console\n                        console.error('üß© Extension Detector: ' +\n                            'Erreur lors de la v√©rification des fichiers pour ' + extension.key, error);\n                    }\n                });\n        });\n    };\n\n    /**\n     * Scanne et supprime tous les √©l√©ments du DOM contenant un ID d'extension sp√©cifique\n     * @memberof ExtensionDetector\n     * @function _scanAndRemoveElementsWithExtensionId\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @param {string} extensionId - ID d'extension √† rechercher\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._scanAndRemoveElementsWithExtensionId = function(extensionKey, extensionId) {\n        if (!Config.SETTINGS.removeDetectedElements) {\n            return;\n        }\n\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Scan du DOM pour supprimer tous les √©l√©ments avec l\\'extension ID  : ' +\n                extensionId);\n        }\n\n        var removedCount = 0;\n\n        // Scanner le DOM principal\n        removedCount += this._scanElementsForExtensionId(document.body, extensionKey, extensionId);\n\n        // Scanner tous les Shadow DOM existants\n        var allElements = document.querySelectorAll('*');\n        for (var i = 0; i < allElements.length; i++) {\n            var element = allElements[i];\n            if (element.shadowRoot) {\n                removedCount += this._scanShadowRootForExtensionId(element.shadowRoot, extensionKey, extensionId);\n            }\n        }\n\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: ' + removedCount + ' √©l√©ments supprim√©s avec l\\'extension ID ' + extensionId);\n        }\n    };\n\n    /**\n     * Scanne un √©l√©ment et ses enfants pour un ID d'extension et les supprime\n     * @memberof ExtensionDetector\n     * @function _scanElementsForExtensionId\n     * @param {Element} rootElement - √âl√©ment racine √† scanner\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @param {string} extensionId - ID d'extension √† rechercher\n     * @returns {number} Nombre d'√©l√©ments supprim√©s\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._scanElementsForExtensionId = function(rootElement, extensionKey, extensionId) {\n        if (!rootElement) {\n            return 0;\n        }\n\n        var removedCount = 0;\n        var elementsToRemove = [];\n\n        // Trouver tous les √©l√©ments contenant l'ID d'extension\n        var allElements = rootElement.querySelectorAll('*');\n        for (var i = 0; i < allElements.length; i++) {\n            var element = allElements[i];\n\n            // S√©curit√©: ne jamais supprimer body, html, head\n            if (element === document.body || element === document.documentElement ||\n                element.tagName === 'BODY' || element.tagName === 'HTML' || element.tagName === 'HEAD') {\n                continue;\n            }\n\n            if (this._elementContainsExtensionId(element, extensionId)) {\n                elementsToRemove.push(element);\n            }\n        }\n\n        // Supprimer les √©l√©ments trouv√©s\n        for (var j = 0; j < elementsToRemove.length; j++) {\n            var elementToRemove = elementsToRemove[j];\n            try {\n                // Logger l'√©l√©ment avant suppression si logging activ√©\n                if (Config.SETTINGS.enableLogging) {\n                    var elementInfo = {\n                        tag: elementToRemove.tagName,\n                        id: elementToRemove.id || '(pas d\\'id)',\n                        class: elementToRemove.className || '(pas de classe)',\n                        html: elementToRemove.outerHTML.substring(0, 200) + '...'\n                    };\n                    // eslint-disable-next-line no-console\n                    console.log('üß© Extension Detector:   ‚Üí √âl√©ment #' + (j + 1) + ' supprim√©:', elementInfo);\n                }\n\n                if (elementToRemove.parentNode) {\n                    elementToRemove.parentNode.removeChild(elementToRemove);\n                    removedCount++;\n                } else if (elementToRemove.remove) {\n                    elementToRemove.remove();\n                    removedCount++;\n                }\n            } catch (error) {\n                // √âchec silencieux\n            }\n        }\n\n        return removedCount;\n    };\n\n    /**\n     * Scanne un Shadow Root pour un ID d'extension et supprime les √©l√©ments\n     * @memberof ExtensionDetector\n     * @function _scanShadowRootForExtensionId\n     * @param {ShadowRoot} shadowRoot - Shadow Root √† scanner\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @param {string} extensionId - ID d'extension √† rechercher\n     * @returns {number} Nombre d'√©l√©ments supprim√©s\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._scanShadowRootForExtensionId = function(shadowRoot, extensionKey, extensionId) {\n        if (!shadowRoot) {\n            return 0;\n        }\n\n        var removedCount = 0;\n        var elementsToRemove = [];\n\n        try {\n            var allElements = shadowRoot.querySelectorAll('*');\n            for (var i = 0; i < allElements.length; i++) {\n                var element = allElements[i];\n\n                if (this._elementContainsExtensionId(element, extensionId)) {\n                    elementsToRemove.push(element);\n                }\n\n                // Scanner r√©cursivement les Shadow DOM imbriqu√©s\n                if (element.shadowRoot) {\n                    removedCount += this._scanShadowRootForExtensionId(element.shadowRoot, extensionKey, extensionId);\n                }\n            }\n\n            // Supprimer les √©l√©ments trouv√©s\n            for (var j = 0; j < elementsToRemove.length; j++) {\n                var elementToRemove = elementsToRemove[j];\n                try {\n                    // Logger l'√©l√©ment avant suppression si logging activ√©\n                    if (Config.SETTINGS.enableLogging) {\n                        var elementInfo = {\n                            tag: elementToRemove.tagName,\n                            id: elementToRemove.id || '(pas d\\'id)',\n                            class: elementToRemove.className || '(pas de classe)',\n                            html: elementToRemove.outerHTML.substring(0, 200) + '...',\n                            location: 'Shadow DOM'\n                        };\n                        // eslint-disable-next-line no-console\n                        console.log('üß© Extension Detector:   ‚Üí √âl√©ment supprim√© depuis Shadow DOM:', elementInfo);\n                    }\n\n                    if (elementToRemove.parentNode) {\n                        elementToRemove.parentNode.removeChild(elementToRemove);\n                        removedCount++;\n                    } else if (elementToRemove.remove) {\n                        elementToRemove.remove();\n                        removedCount++;\n                    }\n                } catch (error) {\n                    // √âchec silencieux\n                }\n            }\n        } catch (error) {\n            // √âchec silencieux\n        }\n\n        return removedCount;\n    };\n\n    /**\n     * V√©rifie si un √©l√©ment contient un ID d'extension sp√©cifique\n     * @memberof ExtensionDetector\n     * @function _elementContainsExtensionId\n     * @param {Element} element - √âl√©ment √† v√©rifier\n     * @param {string} extensionId - ID d'extension √† rechercher\n     * @returns {boolean} True si l'√©l√©ment contient l'ID d'extension\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._elementContainsExtensionId = function(element, extensionId) {\n        if (!element || !extensionId) {\n            return false;\n        }\n\n        var outerHTML = element.outerHTML;\n        var shadowHTML = element.shadowRoot ? element.shadowRoot.innerHTML : '';\n        var combinedHTML = outerHTML + shadowHTML;\n\n        // Chercher l'ID d'extension dans le HTML\n        return combinedHTML.indexOf(extensionId) !== -1;\n    };\n\n    /**\n     * R√©initialise l'√©tat de d√©tection\n     * @memberof ExtensionDetector\n     * @function _resetState\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._resetState = function() {\n        this.detectedExtensions.clear();\n        this.shadowMonitor.reset();\n        this.metricsManager.reset();\n    };\n\n    /**\n     * Obtient les statistiques de d√©tection avec m√©triques simplifi√©es\n     * @memberof ExtensionDetector\n     * @function getStatistics\n     * @returns {Object} Statistiques de d√©tection\n     * @property {number} totalDetections - Nombre total de d√©tections\n     * @property {number} uniquePaths - Nombre de chemins uniques\n     * @property {number} sessionDetections - D√©tections de session\n     * @property {string[]} detectedExtensionsList - Liste des extensions d√©tect√©es\n     * @property {Object|null} lastDetection - Derni√®re d√©tection\n     * @property {Object} metricsData - Donn√©es de m√©triques\n     * @example\n     * const stats = detector.getStatistics();\n     * console.log('Extensions d√©tect√©es:', stats.detectedExtensionsList);\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.getStatistics = function() {\n        var sessionDetections = [];\n        try {\n            sessionDetections = JSON.parse(sessionStorage.getItem('extensionDetections') || '[]');\n        } catch (error) {\n            if (Config.SETTINGS.enableLogging) {\n                // eslint-disable-next-line no-console\n                console.warn('üß© Extension Detector: Impossible de lire les d√©tections de session', error);\n            }\n        }\n\n        return {\n            totalDetections: this.detectedExtensions.size,\n            sessionDetections: sessionDetections.length,\n            detectedExtensionsList: Array.from(this.detectedExtensions),\n            lastDetection: sessionDetections.length > 0 ? sessionDetections[sessionDetections.length - 1] : null,\n            metricsData: this.metricsManager.getData()\n        };\n    };\n\n    /**\n     * Exporte les m√©triques au format JSON\n     * @memberof ExtensionDetector\n     * @function exportMetricsAsJSON\n     * @returns {string} Cha√Æne JSON des m√©triques\n     * @example\n     * const jsonMetrics = detector.exportMetricsAsJSON();\n     * const metrics = JSON.parse(jsonMetrics);\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.exportMetricsAsJSON = function() {\n        return this.metricsManager.exportMetricsAsJSON();\n    };\n\n    /**\n     * Ajoute le support pour une nouvelle extension\n     * @memberof ExtensionDetector\n     * @function addExtensionSupport\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @param {string} extensionName - Nom de l'extension\n     * @example\n     * detector.addExtensionSupport('newExt', 'Nouvelle Extension');\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.addExtensionSupport = function(extensionKey, extensionName) {\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Support ajout√© pour l\\'extension: ' + extensionName);\n        }\n    };\n\n    /**\n     * Obtient la configuration d'extension\n     * @memberof ExtensionDetector\n     * @function getExtensionConfig\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @returns {Object|null} Configuration de l'extension\n     * @example\n     * const config = detector.getExtensionConfig('crowdly');\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.getExtensionConfig = function(extensionKey) {\n        return Config.getExtension(extensionKey);\n    };\n\n    /**\n     * Nettoie les ressources\n     * @memberof ExtensionDetector\n     * @function cleanup\n     * @example\n     * detector.cleanup();\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype.cleanup = function() {\n        if (Config.SETTINGS.enableLogging) {\n            // eslint-disable-next-line no-console\n            console.log('üß© Extension Detector: Nettoyage des ressources');\n        }\n\n        this.stop();\n    };\n\n    /**\n     * Enregistre un √©v√©nement de d√©tection\n     * @memberof ExtensionDetector\n     * @function _logDetection\n     * @param {string} extensionKey - Cl√© de l'extension\n     * @param {string} extensionName - Nom de l'extension\n     * @param {string} method - M√©thode de d√©tection\n     * @private\n     * @since 1.0.0\n     */\n    ExtensionDetector.prototype._logDetection = function(extensionKey, extensionName, method) {\n        if (!Config.SETTINGS.enableLogging) {\n            return;\n        }\n\n        var event = {\n            timestamp: SharedUtils.generateTimestamp().unix,\n            extension: extensionKey,\n            extensionName: extensionName,\n            method: method,\n            url: window.location.href,\n            userAgent: navigator.userAgent\n        };\n\n        try {\n            var history = JSON.parse(sessionStorage.getItem('extensionDetections') || '[]');\n            history.push(event);\n            sessionStorage.setItem('extensionDetections', JSON.stringify(history));\n        } catch (error) {\n            // eslint-disable-next-line no-console\n            console.warn('üß© Extension Detector: Impossible d\\'enregistrer l\\'√©v√©nement de d√©tection', error);\n        }\n    };\n\n    return {\n        ExtensionDetector: ExtensionDetector\n    };\n});"],"names":["define","Config","Browser","Shadow","SharedUtils","MetricsManager","ExtensionDetector","self","this","browserHandler","BrowserHandler","shadowMonitor","ShadowMonitor","extensionKey","extension","method","_onExtensionDetected","metricsManager","setMetricsManager","setExtensionIdDetectedCallback","extensionId","_scanAndRemoveElementsWithExtensionId","detectedExtensions","Set","isRunning","prototype","start","SETTINGS","enableLogging","console","warn","_resetState","error","stop","log","cleanup","restart","setTimeout","has","add","name","_logDetection","_onExtensionIdDetected","extensionPath","extensionPaths","set","Date","now","isExtensionAccessible","then","isAccessible","_checkFilesForAllExtensions","getAllExtensions","forEach","files","Object","keys","length","checkFiles","result","detected","key","catch","removeDetectedElements","removedCount","_scanElementsForExtensionId","document","body","allElements","querySelectorAll","i","element","shadowRoot","_scanShadowRootForExtensionId","rootElement","elementsToRemove","documentElement","tagName","_elementContainsExtensionId","push","j","elementToRemove","elementInfo","tag","id","class","className","html","outerHTML","substring","parentNode","removeChild","remove","location","innerHTML","indexOf","clear","reset","getStatistics","sessionDetections","JSON","parse","sessionStorage","getItem","totalDetections","size","detectedExtensionsList","Array","from","lastDetection","metricsData","getData","exportMetricsAsJSON","addExtensionSupport","extensionName","getExtensionConfig","getExtension","event","timestamp","generateTimestamp","unix","url","window","href","userAgent","navigator","history","setItem","stringify"],"mappings":"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"}