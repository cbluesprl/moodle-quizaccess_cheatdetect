{"version":3,"file":"utils.min.js","sources":["../../src/shared/utils.js"],"sourcesContent":["/**\n * @fileoverview Utilitaires partagés entre les modules d'extension-detector et tracking\n * @module quizaccess_cheatdetect/shared/utils\n * @copyright 2025 CBlue SRL <support@cblue.be>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 1.0.0\n */\n\ndefine([], function() {\n    'use strict';\n\n    /**\n     * Génère un identifiant unique aléatoire\n     * @function generateUniqueId\n     * @returns {string} Identifiant unique de longueur variable (8-16 caractères)\n     * @example\n     * const id = generateUniqueId();\n     * console.log(id); // \"a7B9x_2K\"\n     * @since 1.0.0\n     */\n    var generateUniqueId = function() {\n        var validChars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_';\n        var length = Math.floor(Math.random() * 9) + 8;\n        var result = '';\n\n        var firstCharOptions = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_';\n        result += firstCharOptions[Math.floor(Math.random() * firstCharOptions.length)];\n\n        for (var i = 1; i < length; i++) {\n            result += validChars[Math.floor(Math.random() * validChars.length)];\n        }\n\n        return result;\n    };\n\n    /**\n     * Génère un horodatage fiable avec informations de timezone\n     * @function generateTimestamp\n     * @returns {Object} Objet contenant le timestamp Unix et le timezone\n     * @property {number} unix - Timestamp Unix en millisecondes\n     * @property {string} timezone - Timezone locale de l'utilisateur\n     * @example\n     * const timestamp = generateTimestamp();\n     * // { unix: 1640995200000, timezone: \"Europe/Paris\" }\n     * @since 1.0.0\n     */\n    var generateTimestamp = function() {\n        return {\n            unix: Date.now(),\n            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone\n        };\n    };\n\n    /**\n     * Fetch avec timeout personnalisé\n     * @function fetchWithTimeout\n     * @param {string} url - URL à récupérer\n     * @param {number} [timeout=5000] - Timeout en millisecondes\n     * @returns {Promise<Object>} Promesse qui résout avec le résultat de fetch\n     * @property {boolean} success - Indique si la requête a réussi\n     * @property {number} [status] - Code de statut HTTP si succès\n     * @property {Response} [response] - Objet Response si succès\n     * @property {string} [error] - Message d'erreur si échec\n     * @example\n     * fetchWithTimeout('https://example.com/api', 3000)\n     *   .then(result => {\n     *     if (result.success) {\n     *       return result.response.json();\n     *     }\n     *   });\n     * @since 1.0.0\n     */\n    var fetchWithTimeout = function(url, timeout) {\n        timeout = timeout || 5000;\n\n        return new Promise(function(resolve) {\n            var controller = new AbortController();\n            var timeoutId = setTimeout(function() {\n                controller.abort();\n            }, timeout);\n\n            fetch(url, { signal: controller.signal })\n                .then(function(response) {\n                    clearTimeout(timeoutId);\n                    resolve({\n                        success: response.ok,\n                        status: response.status,\n                        response: response.ok ? response : null\n                    });\n                })\n                .catch(function(error) {\n                    clearTimeout(timeoutId);\n                    resolve({\n                        success: false,\n                        error: error.name === 'AbortError' ? 'Timeout' : error.message\n                    });\n                });\n        });\n    };\n\n    /**\n     * Fonction de debounce pour limiter la fréquence d'exécution\n     * @function debounce\n     * @param {Function} func - Fonction à débouncer\n     * @param {number} delay - Délai en millisecondes\n     * @returns {Function} Fonction débouncée\n     * @example\n     * const debouncedHandler = debounce(() => {\n     *   console.log('Exécuté!');\n     * }, 300);\n     * @since 1.0.0\n     */\n    var debounce = function(func, delay) {\n        var timeoutId;\n        return function() {\n            var context = this;\n            var args = arguments;\n            clearTimeout(timeoutId);\n            timeoutId = setTimeout(function() {\n                func.apply(context, args);\n            }, delay);\n        };\n    };\n\n    /**\n     * Extrait l'ID d'extension depuis une URL ou du contenu\n     * @function extractExtensionId\n     * @param {string} content - Contenu à analyser\n     * @returns {string|null} URL d'extension trouvée ou null\n     * @example\n     * const id = extractExtensionId('chrome-extension://abcdef123456/script.js');\n     * // \"chrome-extension://abcdef123456\"\n     * @since 1.0.0\n     */\n    var extractExtensionId = function(content) {\n        var regex = /(chrome-extension:\\/\\/|moz-extension:\\/\\/)([a-z0-9-]+)/;\n        var match = content.match(regex);\n        return match ? match[0] : null;\n    };\n\n    /**\n     * Vérifie si un nœud DOM contient des mots-clés spécifiés\n     * @function containsKeywords\n     * @param {Node} node - Nœud DOM à analyser\n     * @param {string[]} keywords - Tableau de mots-clés à rechercher\n     * @returns {boolean} True si au moins un mot-clé est trouvé\n     * @example\n     * const hasKeywords = containsKeywords(element, ['crowdly', 'AI Magic']);\n     * @since 1.0.0\n     */\n    var containsKeywords = function(node, keywords) {\n        if (!node || !keywords || keywords.length === 0) return false;\n\n        if (node.textContent && keywords.some(function(keyword) {\n            return node.textContent.toLowerCase().includes(keyword.toLowerCase());\n        })) {\n            return true;\n        }\n\n        if (node.childNodes) {\n            for (var i = 0; i < node.childNodes.length; i++) {\n                var childNode = node.childNodes[i];\n                if (childNode.nodeType === Node.ELEMENT_NODE && containsKeywords(childNode, keywords)) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    };\n\n    /**\n     * Vérifie si un élément correspond aux motifs spécifiés\n     * @function matchesPatterns\n     * @param {Element} element - Élément DOM à vérifier\n     * @param {string[]} patterns - Motifs à rechercher dans l'ID et les classes\n     * @returns {boolean} True si l'élément correspond à au moins un motif\n     * @example\n     * const matches = matchesPatterns(element, ['crowd', 'ai-helper']);\n     * @since 1.0.0\n     */\n    var matchesPatterns = function(element, patterns) {\n        if (!element || !patterns) return false;\n\n        var elementId = (element.id || '').toLowerCase();\n        var className = (element.className || '').toLowerCase();\n\n        return patterns.some(function(pattern) {\n            var lowerPattern = pattern.toLowerCase();\n            return elementId.includes(lowerPattern) || className.includes(lowerPattern);\n        });\n    };\n\n    /**\n     * Vérifie si le contenu contient des motifs spécifiés\n     * @function containsPatterns\n     * @param {string} content - Contenu à analyser\n     * @param {string[]} patterns - Motifs à rechercher\n     * @returns {boolean} True si au moins un motif est trouvé\n     * @example\n     * const hasPatterns = containsPatterns(text, ['extension', 'browser']);\n     * @since 1.0.0\n     */\n    var containsPatterns = function(content, patterns) {\n        if (!content || !patterns) return false;\n\n        return patterns.some(function(pattern) {\n            return content.toLowerCase().includes(pattern.toLowerCase());\n        });\n    };\n\n    /**\n     * Supprime un élément DOM de manière sécurisée\n     * @function removeElement\n     * @param {Element} element - Élément à supprimer\n     * @returns {boolean} True si la suppression a réussi\n     * @example\n     * const removed = removeElement(suspiciousElement);\n     * if (removed) console.log('Élément supprimé avec succès');\n     * @since 1.0.0\n     */\n    var removeElement = function(element) {\n        if (!element) return false;\n\n        try {\n            if (element.parentNode) {\n                element.parentNode.removeChild(element);\n                return true;\n            } else {\n                element.remove();\n                return true;\n            }\n        } catch (error) {\n            return false;\n        }\n    };\n\n    return {\n        generateUniqueId: generateUniqueId,\n        generateTimestamp: generateTimestamp,\n        fetchWithTimeout: fetchWithTimeout,\n        debounce: debounce,\n        extractExtensionId: extractExtensionId,\n        containsKeywords: containsKeywords,\n        matchesPatterns: matchesPatterns,\n        containsPatterns: containsPatterns,\n        removeElement: removeElement\n    };\n});\n"],"names":["define","containsKeywords","node","keywords","length","textContent","some","keyword","toLowerCase","includes","childNodes","i","childNode","nodeType","Node","ELEMENT_NODE","generateUniqueId","validChars","Math","floor","random","result","firstCharOptions","generateTimestamp","unix","Date","now","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","fetchWithTimeout","url","timeout","Promise","resolve","controller","AbortController","timeoutId","setTimeout","abort","fetch","signal","then","response","clearTimeout","success","ok","status","catch","error","name","message","debounce","func","delay","context","this","args","arguments","apply","extractExtensionId","content","match","matchesPatterns","element","patterns","elementId","id","className","pattern","lowerPattern","containsPatterns","removeElement","parentNode","removeChild","remove"],"mappings":";;;;;;;AAQAA,6CAAO,IAAI,eA8IHC,iBAAmB,SAASC,KAAMC,cAC7BD,OAASC,UAAgC,IAApBA,SAASC,OAAc,OAAO,KAEpDF,KAAKG,aAAeF,SAASG,MAAK,SAASC,gBACpCL,KAAKG,YAAYG,cAAcC,SAASF,QAAQC,yBAEhD,KAGPN,KAAKQ,eACA,IAAIC,EAAI,EAAGA,EAAIT,KAAKQ,WAAWN,OAAQO,IAAK,KACzCC,UAAYV,KAAKQ,WAAWC,MAC5BC,UAAUC,WAAaC,KAAKC,cAAgBd,iBAAiBW,UAAWT,iBACjE,SAKZ,SAqEJ,CACHa,iBA1NmB,eACfC,WAAa,mEACbb,OAASc,KAAKC,MAAsB,EAAhBD,KAAKE,UAAgB,EACzCC,OAAS,GAETC,iBAAmB,wDACvBD,QAAUC,iBAAiBJ,KAAKC,MAAMD,KAAKE,SAAWE,iBAAiBlB,aAElE,IAAIO,EAAI,EAAGA,EAAIP,OAAQO,IACxBU,QAAUJ,WAAWC,KAAKC,MAAMD,KAAKE,SAAWH,WAAWb,gBAGxDiB,QA+MPE,kBAjMoB,iBACb,CACHC,KAAMC,KAAKC,MACXC,SAAUC,KAAKC,iBAAiBC,kBAAkBC,WA+LtDC,iBAxKmB,SAASC,IAAKC,gBACjCA,QAAUA,SAAW,IAEd,IAAIC,SAAQ,SAASC,aACpBC,WAAa,IAAIC,gBACjBC,UAAYC,YAAW,WACvBH,WAAWI,UACZP,SAEHQ,MAAMT,IAAK,CAAEU,OAAQN,WAAWM,SAC3BC,MAAK,SAASC,UACXC,aAAaP,WACbH,QAAQ,CACJW,QAASF,SAASG,GAClBC,OAAQJ,SAASI,OACjBJ,SAAUA,SAASG,GAAKH,SAAW,UAG1CK,OAAM,SAASC,OACZL,aAAaP,WACbH,QAAQ,CACJW,SAAS,EACTI,MAAsB,eAAfA,MAAMC,KAAwB,UAAYD,MAAME,iBAmJvEC,SAjIW,SAASC,KAAMC,WACtBjB,iBACG,eACCkB,QAAUC,KACVC,KAAOC,UACXd,aAAaP,WACbA,UAAYC,YAAW,WACnBe,KAAKM,MAAMJ,QAASE,QACrBH,SA0HPM,mBA5GqB,SAASC,aAE1BC,MAAQD,QAAQC,MADR,iEAELA,MAAQA,MAAM,GAAK,MA0G1B/D,iBAAkBA,iBAClBgE,gBA/DkB,SAASC,QAASC,cAC/BD,UAAYC,SAAU,OAAO,MAE9BC,WAAaF,QAAQG,IAAM,IAAI7D,cAC/B8D,WAAaJ,QAAQI,WAAa,IAAI9D,qBAEnC2D,SAAS7D,MAAK,SAASiE,aACtBC,aAAeD,QAAQ/D,qBACpB4D,UAAU3D,SAAS+D,eAAiBF,UAAU7D,SAAS+D,kBAwDlEC,iBA1CmB,SAASV,QAASI,mBAChCJ,UAAYI,WAEVA,SAAS7D,MAAK,SAASiE,gBACnBR,QAAQvD,cAAcC,SAAS8D,QAAQ/D,mBAuClDkE,cAzBgB,SAASR,aACpBA,QAAS,OAAO,aAGbA,QAAQS,YACRT,QAAQS,WAAWC,YAAYV,UACxB,IAEPA,QAAQW,UACD,GAEb,MAAO1B,cACE"}