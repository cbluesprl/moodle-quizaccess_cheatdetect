/**
 * This JS is made to enhance the /mod/quiz/report.php?id=X&mode=overview core_moodle report table
 * and /mod/quiz/reviewquestion.php pages
 *
 * @module     quizaccess_cheatdetect/report_enhancer
 * @package
 * @copyright   2025 CBlue SPRL
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author      gnormand@cblue.be
 */
define("quizaccess_cheatdetect/report_enhancer",["jquery","core/ajax","core/notification","core/str"],function($,Ajax,Notification,Str){var enhanceReportTable=function(){if(0!==$("table.generaltable").length){console.log("CheatDetect: Enhancing report table"),addIconsToReviewLinks(),addIconsToQuestionResults();var attemptIds=[1,45,78];if(0!==attemptIds.length)return attemptIds;console.warn("CheatDetect: No attempts found")}else console.warn("CheatDetect: Report table not found")},addIconsToReviewLinks=function(){$(".reviewlink").each(function(){var $link=$(this);if(!($link.find(".cheatdetect-icon").length>0)){var $icon=$("<i>").addClass("fa fa-eye cheatdetect-icon").attr("aria-hidden","true").css({"margin-left":"8px",color:"#0066cc"});$link.append(" ").append($icon)}})},addIconsToQuestionResults=function(){$("table.generaltable tbody tr").each(function(){$(this).find('td[class*="c9"], td[class*="c10"], td[class*="c11"], td[class*="c12"], td[class*="c13"],td[class*="c14"], td[class*="c15"], td[class*="c16"], td[class*="c17"], td[class*="c18"]').each(function(){var $link=$(this).find('a[href*="reviewquestion.php"]');if($link.length>0){if($link.find(".cheatdetect-qicon").length>0)return;var $icon=$("<i>").addClass("fa fa-flag cheatdetect-qicon").attr("aria-hidden","true").css({"margin-left":"6px",color:"#ff6600","font-size":"0.9em"});$link.append(" ").append($icon)}})})},enhanceReviewQuestionPage=function(){console.log("CheatDetect: Enhancing review question page");var attemptId=getUrlParameter("attempt"),slotId=getUrlParameter("slot");attemptId&&slotId?fetchAttemptSummary(attemptId,slotId):console.warn("CheatDetect: Missing attempt or slot parameter in URL")},getUrlParameter=function(name){return new URLSearchParams(window.location.search).get(name)},fetchAttemptSummary=function(attemptId,slotId){var url="/local/rest/api/quizaccess_cheatdetect/attempt-summary/"+attemptId+"/slots/"+slotId;$.ajax({url:url,method:"GET",dataType:"json",success:function(response){response.success&&response.data?createCheatDetectResumeBlock(response.data):console.warn("CheatDetect: Invalid response from webservice",response)},error:function(xhr,status,error){console.error("CheatDetect: Error fetching attempt summary",error)}})},createCheatDetectResumeBlock=function(data){if(!($(".cheatdetect_resume").length>0)){var timeInMinutes=Math.round(data.time_spent/60),timePercentage=Math.round(data.time_percentage);Str.get_strings([{key:"timespent",component:"quizaccess_cheatdetect"},{key:"copycount",component:"quizaccess_cheatdetect"},{key:"focuslosscount",component:"quizaccess_cheatdetect"},{key:"extensiondetected",component:"quizaccess_cheatdetect"},{key:"yes",component:"quizaccess_cheatdetect"},{key:"no",component:"quizaccess_cheatdetect"}]).then(function(strings){var timeSpentStr=strings[0],copyCountStr=strings[1],focusLossCountStr=strings[2],extensionDetectedStr=strings[3],yesStr=strings[4],noStr=strings[5],extensionText=data.has_extension?yesStr:noStr,$resumeBlock=$("<div>").addClass("cheatdetect_resume").css({"background-color":"#d3d3d3",padding:"1rem 1rem","margin-bottom":"1rem",border:"var(--bs-border-width) solid #fff0","border-radius":"var(--bs-border-radius)","font-size":"14px","line-height":"1.6"}),timeSpentText=timeSpentStr.replace("{$a->minutes}",timeInMinutes).replace("{$a->percentage}",timePercentage),$timeLine=$("<div>").text(timeSpentText),copyCountText=copyCountStr.replace("{$a}",data.copy_count),$copyLine=$("<div>").text(copyCountText).css("color",data.copy_count>0?"#ff0000":"inherit"),focusLossCountText=focusLossCountStr.replace("{$a}",data.focus_loss_count),$focusLine=$("<div>").text(focusLossCountText).css("color",data.focus_loss_count>0?"#ff0000":"inherit"),extensionDetectedText=extensionDetectedStr.replace("{$a}",extensionText),$extensionLine=$("<div>").text(extensionDetectedText);$resumeBlock.append($timeLine).append($copyLine).append($focusLine).append($extensionLine);var $outcomeContainer=$(".outcome");if($outcomeContainer.length>0)$outcomeContainer.after($resumeBlock);else{var $targetContainer=$(".que");$targetContainer.length>0?$targetContainer.prepend($resumeBlock):$("#page-content").prepend($resumeBlock)}console.log("CheatDetect: Resume block added successfully")}).catch(function(error){console.error("CheatDetect: Error loading strings",error)})}};return{init:function(params){$(document).ready(function(){enhanceReportTable(),enhanceReviewQuestionPage()})}}});

//# sourceMappingURL=report_enhancer.min.js.map